!function(){"use strict";function e(){e=function(){return t};var t={},n=Object.prototype,s=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function u(e,t,n,s){var r=t&&t.prototype instanceof g?t:g,a=Object.create(r.prototype),i=new T(s||[]);return o(a,"_invoke",{value:S(e,n,i)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var p={};function g(){}function h(){}function w(){}var f={};l(f,a,(function(){return this}));var m=Object.getPrototypeOf,b=m&&m(m(L([])));b&&b!==n&&s.call(b,a)&&(f=b);var v=w.prototype=g.prototype=Object.create(f);function y(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function n(o,r,a,i){var c=d(e[o],e,r);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==typeof u&&s.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,a,i)}),(function(e){n("throw",e,a,i)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,s){function o(){return new t((function(t,o){n(e,s,t,o)}))}return r=r?r.then(o,o):o()}})}function S(e,t,n){var s="suspendedStart";return function(o,r){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===o)throw r;return P()}for(n.method=o,n.arg=r;;){var a=n.delegate;if(a){var i=x(a,n);if(i){if(i===p)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===s)throw s="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);s="executing";var c=d(e,t,n);if("normal"===c.type){if(s=n.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(s="completed",n.method="throw",n.arg=c.arg)}}}function x(e,t){var n=t.method,s=e.iterator[n];if(void 0===s)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),p;var o=d(s,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,p;var r=o.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function L(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(s.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:P}}function P(){return{value:void 0,done:!0}}return h.prototype=w,o(v,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:h,configurable:!0}),h.displayName=l(w,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,l(e,c,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},y(k.prototype),l(k.prototype,i,(function(){return this})),t.AsyncIterator=k,t.async=function(e,n,s,o,r){void 0===r&&(r=Promise);var a=new k(u(e,n,s,o),r);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},y(v),l(v,c,"Generator"),l(v,a,(function(){return this})),l(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var s in t)n.push(s);return n.reverse(),function e(){for(;n.length;){var s=n.pop();if(s in t)return e.value=s,e.done=!1,e}return e.done=!0,e}},t.values=L,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&s.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,s){return a.type="throw",a.arg=e,t.next=n,s&&(t.method="next",t.arg=void 0),!!s}for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o],a=r.completion;if("root"===r.tryLoc)return n("end");if(r.tryLoc<=this.prev){var i=s.call(r,"catchLoc"),c=s.call(r,"finallyLoc");if(i&&c){if(this.prev<r.catchLoc)return n(r.catchLoc,!0);if(this.prev<r.finallyLoc)return n(r.finallyLoc)}else if(i){if(this.prev<r.catchLoc)return n(r.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return n(r.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&s.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=e,a.arg=t,r?(this.method="next",this.next=r.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var s=n.completion;if("throw"===s.type){var o=s.arg;E(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:L(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},t}function t(e,t,n,s,o,r,a){try{var i=e[r](a),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(s,o)}function n(e){return function(){var n=this,s=arguments;return new Promise((function(o,r){var a=e.apply(n,s);function i(e){t(a,o,r,i,c,"next",e)}function c(e){t(a,o,r,i,c,"throw",e)}i(void 0)}))}}function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},s.apply(this,arguments)}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function r(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var s=0;return function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function a(e,t,n,s){var o,r,a,i,c=!1,l=!1,u={},d=0,p=0,g={sensitivity:7,interval:100,timeout:0,handleFocus:!1};function h(e){o=e.clientX,r=e.clientY}function w(e,t){if(p&&(p=clearTimeout(p)),Math.abs(a-o)+Math.abs(i-r)<g.sensitivity)return d=1,l?void 0:n(e,t);a=o,i=r,p=setTimeout((function(){w(e,t)}),g.interval)}function f(e,t){return c=!0,p&&(p=clearTimeout(p)),e.removeEventListener("mousemove",h,!1),1!==d&&(a=t.clientX,i=t.clientY,e.addEventListener("mousemove",h,!1),p=setTimeout((function(){w(e,t)}),g.interval)),this}function m(e){e.target.matches(t+", "+t+" *")&&f(e.target.closest(t),e)}function b(e,t){return c=!1,p&&(p=clearTimeout(p)),e.removeEventListener("mousemove",h,!1),1===d&&(p=setTimeout((function(){!function(e,t){p&&(p=clearTimeout(p)),d=0,l||s(e,t)}(e,t)}),g.timeout)),this}function v(e){e.target.matches(t+", "+t+" *")&&b(e.target.closest(t),e)}function y(e){var s,o;e.target.matches(t+", "+t+" *")&&(s=e.target.closest(t),o=e,c||(l=!0,n(s,o)))}function k(e){var n,o;e.target.matches(t+", "+t+" *")&&(n=e.target.closest(t),o=e,!c&&l&&(l=!1,s(n,o)))}function S(){e.removeEventListener("focus",y,!1),e.removeEventListener("blur",k,!1)}return u.options=function(t){var n=t.handleFocus!==g.handleFocus;return g=Object.assign({},g,t),n&&(g.handleFocus?(e.addEventListener("focus",y,!1),e.addEventListener("blur",k,!1)):S()),u},u.remove=function(){e&&(e.removeEventListener("mouseover",m,!1),e.removeEventListener("mouseout",v,!1),S())},e&&(e.addEventListener("mouseover",m,!1),e.addEventListener("mouseout",v,!1)),u}Element.prototype.closest&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest=function(e){var t=this;do{if(Element.prototype.matches.call(t,e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null});var i=function(){function t(e){void 0===e&&(e=wpstg),this.wpstgObject=e}return t.prototype.sendRequest=function(){var t=n(e().mark((function t(n){var s,o;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg--detect-memory-exhaust",requestType:n,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 3:return s=e.sent,e.next=6,s.json();case 6:if(void 0===(o=e.sent).status||!o.status||!o.error){e.next=9;break}return e.abrupt("return",o);case 9:console.warn(o.message),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.warn(this.wpstgObject.i18n.somethingWentWrong,e.t0);case 15:return e.abrupt("return",!1);case 16:case"end":return e.stop()}}),t,this,[[0,12]])})));return function(e){return t.apply(this,arguments)}}(),t}(),c=function(t){var s={continueErrorHandle:!0,retry:{currentDelay:0,count:0,max:wpstg.maxFailedRetries,retryOnErrors:[401,403,404,429,502,503,504],performingRequest:!1,incrementRetry:function(e){void 0===e&&(e=1.25),s.retry.performingRequest=!0,0===s.retry.currentDelay&&(s.retry.currentDelay=1e3,s.retry.count=1),s.retry.currentDelay+=500*s.retry.count*e,s.retry.count++},canRetry:function(){return s.retry.count<s.retry.max},reset:function(){s.retry.currentDelay=0,s.retry.count=0,s.retry.performingRequest=!1}},memoryExhaustArticleLink:"https://wp-staging.com/docs/php-fatal-error-allowed-memory-size-of-134217728-bytes-exhausted/",cache:{elements:[],get:function(e){return-1!==t.inArray(e,this.elements)||(this.elements[e]=t(e)),this.elements[e]},refresh:function(e){e.elements[e]=t(e)}},setJobId:function(e){localStorage.setItem("jobIdBeingProcessed",e)},getJobId:function(){return localStorage.getItem("jobIdBeingProcessed")},checkMemoryExhaustion:function(t){return n(e().mark((function n(){var s,o;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=new i,e.next=3,s.sendRequest(t);case 3:if(o=e.sent){e.next=6;break}return e.abrupt("return",!1);case 6:return e.abrupt("return",o);case 10:case"end":return e.stop()}}),n)})))()},listenTooltip:function(){a(document,".wpstg--tooltip",(function(e,t){e.querySelector(".wpstg--tooltiptext").style.visibility="visible"}),(function(e,t){t.target.closest(".wpstg--tooltiptext a")||(e.querySelector(".wpstg--tooltiptext").style.visibility="hidden")}))},getSwalModal:function(e,t){void 0===e&&(e=!1),void 0===t&&(t={});var n={confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn wpstg-100-width",cancelButton:"wpstg--btn--cancel wpstg-blue-primary wpstg-link-btn wpstg-100-width",actions:"wpstg--modal--actions",popup:e?"wpstg-swal-popup wpstg-centered-modal":"wpstg-swal-popup"},s={customClass:Object.assign(n,t),buttonsStyling:!1,reverseButtons:!0,showClass:{popup:"wpstg--swal2-show wpstg-swal-show"}};return wpstgSwal.mixin(s)},showSuccessModal:function(e){this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:"OK",icon:"success",title:"Success!",html:'<div class="wpstg--grey" style="text-align: left; margin-top: 8px;">'+e+"</div>"})},showWarningModal:function(e){this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:"OK",icon:"warning",title:"",html:'<div class="wpstg--grey" style="text-align: left; margin-top: 8px;">'+e+"</div>"})},showErrorModal:function(e){this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:"OK",icon:"error",title:"Error!",html:'<div class="wpstg--grey" style="text-align: left; margin-top: 8px;">'+e+"</div>"})},getSwalContainer:function(){return wpstgSwal.getContainer()},closeSwalModal:function(){wpstgSwal.close()},getDataFromWordPressResponse:function(e){if("object"!=typeof e)throw new Error("Unexpected response (ERR 1341)");if(!e.hasOwnProperty("success"))throw new Error("Unexpected response (ERR 1342)");if(!e.hasOwnProperty("data"))throw new Error("Unexpected response (ERR 1343)");if(!1===e.success)throw e.data instanceof Array&&e.data.length>0?new Error(e.data.shift()):new Error("Response was not successful");return e.data},isLoading:function(e){e&&!1!==e?s.cache.get(".wpstg-loader").show():s.cache.get(".wpstg-loader").hide()},slugify:function(e){return e.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"-").replace(/&/g,"-and-").replace(/[^a-z0-9\-]/g,"").replace(/-+/g,"-").replace(/^-*/,"").replace(/-*$/,"")},sanitizeEventAttribute:function(e){return null===e?e:e.toString().replace(/("|')\s+on([a-z]+)\s?=\s?([a-z0-9\)\(\"\';]+)/i,"")},htmlEntityQuotesDecode:function(e){return null===e?e:e.toString().replace(/\\"/g,"&quot;").replace(/\\'/g,"&#039")},showAjaxFatalError:function(e,t,n){return t=t?t+"<br/><br/>":"Something went wrong! <br/><br/>",n=n?n+"<br/><br/>":"<br/><br/>Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.",!1===e?(s.showError(t+" Error: No response."+n),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):void 0!==e.error&&e.error?(s.showError(t+" Error: "+e.message+n),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):void 0},handleFetchErrors:function(e){return e.ok||s.showError("Error: "+e.status+" - "+e.statusText+". Please try again or contact support."),e},showError:function(e){s.retry.performingRequest||(s.cache.get("#wpstg-try-again").css("display","inline-block"),s.cache.get("#wpstg-cancel-cloning").text("Reset"),s.cache.get("#wpstg-resume-cloning").show(),s.cache.get("#wpstg-error-wrapper").show(),s.cache.get("#wpstg-error-details").show().html(e),s.cache.get("#wpstg-removing-clone").removeClass("loading"),s.cache.get(".wpstg-loader").hide(),t(".wpstg--modal--process--generic-problem").show().html(e))},resetErrors:function(){s.cache.get("#wpstg-error-details").hide().html("")},ajax:function(e,n,o,r,a,i,c){void 0===i&&(i=null),void 0===c&&(c=null),void 0===o&&(o="json"),!1!==r&&(r=!0),a=void 0===a?0:a;var l=wpstg.maxFailedRetries,u=1e4*a;i=parseInt(i),isNaN(i)||(u*=i),t.ajax({url:ajaxurl+"?action=wpstg_processing&_="+Date.now()/1e3,type:"POST",dataType:o,cache:!1,data:e,error:function(t,d,p){if(console.log(t.status+" "+t.statusText+"---"+d),"function"!=typeof c||(c(t,d,p),s.continueErrorHandle))if(++a<=l)setTimeout((function(){s.ajax(e,n,o,r,a,i)}),u);else{var g=void 0===t.status?"Unknown":t.status;s.showError("Fatal Error:  "+g+" Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.")}else s.continueErrorHandle=!0},success:function(e){"function"==typeof n&&n(e)},statusCode:{404:function(){a>=l&&s.showError("Error 404 - Can't find ajax request URL! Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.")},500:function(){a>=l&&s.showError("Fatal Error 500 - Internal server error while processing the request! Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.")},504:function(){a>l&&s.showError("Error 504 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},502:function(){a>=l&&s.showError("Error 502 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},503:function(){a>=l&&s.showError("Error 503 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},429:function(){a>=l&&s.showError("Error 429 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},403:function(){a>=l&&s.showError("Refresh page or login again! The process should be finished successfully. \n ")}}})}};return s}(jQuery);function l(e){return document.querySelector(e)}function u(e,t,n,s){!e instanceof Element||e.addEventListener(t,(function(e){e.target.matches(n+", "+n+" *")&&s(e.target.closest(n),e)}),!1)}function d(e,t){void 0===t&&(t=400),e.style.display="block",e.style.overflow="hidden";var n=e.offsetHeight;e.style.height="0px",e.style.transitionProperty="height",e.style.transitionDuration=t+"ms",setTimeout((function(){e.style.height=n+"px",window.setTimeout((function(){e.style.removeProperty("height"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")}),t)}),0)}function p(e,t){void 0===t&&(t=400),e.style.display="block",e.style.overflow="hidden";var n=e.offsetHeight;e.style.height=n+"px",e.style.transitionProperty="height",e.style.transitionDuration=t+"ms",setTimeout((function(){e.style.height="0px",window.setTimeout((function(){e.style.display="none",e.style.removeProperty("height"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")}),t)}),0)}function g(e,t){void 0===t&&(t=300),e.style.opacity=1,e.style.transitionProperty="opacity",e.style.transitionDuration=t+"ms",setTimeout((function(){e.style.opacity=0,window.setTimeout((function(){e.style.display="none",e.style.removeProperty("opacity"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")}),t)}),0)}function h(e,t){for(var n=e.previousElementSibling;n;){if(n.matches(t))return n;n=n.previousElementSibling}}function w(e,t){for(var n=[],s=e&&e.parentElement;s;s=s.parentElement)s.matches(t)&&n.push(s);return n}function f(e,t,n,s){return c.getSwalModal(!1,{container:"wpstg-swal-push-container",confirmButton:s+" wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn"}).fire({title:e,icon:"warning",html:t,width:"750px",focusConfirm:!1,confirmButtonText:n,showCancelButton:!0})}function m(e){document.querySelectorAll(e).forEach((function(e){e.style.display="none"}))}function b(e){document.querySelectorAll(e).forEach((function(e){e.style.display="block"}))}function v(e,t){new Notyf({duration:6e3,position:{x:"center",y:"bottom"},dismissible:!0,types:[{type:"warning",background:"orange",icon:!0}]}).open({type:e,message:t})}function y(e){void 0===e&&(e="visible"),document.querySelectorAll(".wpstg-loading-bar-container").forEach((function(t){t&&(t.style.visibility=e)}))}function k(e){var t=l(e);return!!t&&t.checked}function S(e,t){void 0===t&&(t="");var n=l(e);return n?n.value:t}function x(e){void 0===e&&(e="visible");var t,n=(t=".wpstg-loading-placeholder-container",document.querySelectorAll(t));n.forEach((function(t){t&&(t.style.visibility=e)})),setTimeout((function(){n.forEach((function(e){e&&"visible"===e.style.visibility&&(e.style.visibility="hidden")})),T()}),5e3);var s=l(".wpstg--tab--contents");if("visible"===e)return y(),void(s&&(s.style.overflow="hidden"));T(),s&&(s.style.overflow="unset")}function C(){return(C=n(e().mark((function t(n){var s,o,r,a,i,c;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===n&&(n=""),""===n&&(n=l(".wpstg--tab--contents")),null!==n){e.next=4;break}return e.abrupt("return");case 4:if(s=n.querySelector(".wpstg-loading-placeholder-container"),o=s.querySelector(".wpstg-dom-loading-wrapper")){e.next=8;break}return e.abrupt("return");case 8:if(o.offsetHeight===n.offsetHeight){e.next=19;break}o.querySelectorAll(".wpstg-loading-lines-bar").forEach((function(e){return e.remove()})),null==(r=o.querySelector(".wpstg-loading-line"))||r.remove(),null==(a=o.querySelector(".wpstg-loading-last-line-bar"))||a.remove();case 13:return o.insertAdjacentHTML("beforeend",'<div class="wpstg-loading-lines-bar"></div>'),e.next=16,new Promise((function(e){return setTimeout(e,0)}));case 16:if(o.offsetHeight<=n.offsetHeight-40){e.next=13;break}case 17:null==(i=o.firstElementChild)||i.classList.add("wpstg-loading-first-line-bar"),null==(c=o.lastElementChild)||c.classList.add("wpstg-loading-last-line-bar");case 19:return e.next=21,new Promise((function(e){return setTimeout(e,0)}));case 21:case"end":return e.stop()}}),t)})))).apply(this,arguments)}function E(e){void 0===e&&(e=""),null!==e&&e||(e=document);var t=e.querySelector(".wpstg-corrupted-backup");t&&document.querySelectorAll(".wpstg-clone.wpstg-backup").forEach((function(e){e.classList.add("wpstg-corrupted-backups-min-height")}));var n=e.querySelector(".wpstg-invalid-backup-tabs");!e.querySelector(".wpstg-automated-backup")&&!n||t||document.querySelectorAll(".wpstg-clone.wpstg-backup").forEach((function(e){e.classList.add("wpstg-multiparts-backups-min-height")}))}function T(){document.querySelectorAll(".wpstg-loading-bar-container").forEach((function(e){e&&(e.style.visibility="hidden")}))}var L=function(){function e(e,t,n){void 0===e&&(e="#wpstg-workflow"),void 0===t&&(t=wpstg),void 0===n&&(n="wpstg_database_connect"),this.workflow=l(e),this.wpstgObject=t,this.databaseCheckAction=n,this.isDbConnected=!1,this.dbConnectionTest="#wpstg-test-db-connection",this.dbCheckCallStatus=!1,this.init()}var t=e.prototype;return t.addEvents=function(){var e=this;null!==this.workflow&&u(this.workflow,"click",this.dbConnectionTest,(function(){e.dbCheckCallStatus||e.checkDatabase()}))},t.init=function(){this.addEvents()},t.checkDatabase=function(e){var t=this,n="#wpstg-edit-clone-data-",s=l(n+"database-user").value,o=l(n+"database-password").value,r=l(n+"database-database").value,a=l(n+"database-server").value,i=l(n+"database-prefix").value,c=l(n+"database-ssl").checked,u=l(n+"prefix");return""===u.value&&""===s&&""===r&&""===i?(u.style.borderColor="red",v("error","Warning: Database table prefix can not be empty!"),e?e():""):(u.style.borderColor="",""===s&&""===o&&""===r&&""===i?(this.isDbConnected=!0,e?e():""):(e?this.dbCheckCallStatus=!0:this.setDbCallStatus(),void fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:this.databaseCheckAction,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,databaseUser:s,databasePassword:o,databaseServer:a,databaseDatabase:r,databasePrefix:i,databaseSsl:c,databaseEnsurePrefixTableExist:!0}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(n){if(t.isDbConnected=!0===n.success,e)return t.dbCheckCallStatus=!1,void e();t.setDbCallStatus(!1);var s="";n.data&&"undefined"!==n.data&&"undefined"!==n.data.message&&(s=n.data.message),n.success?v("success",t.wpstgObject.i18n.dbConnectionSuccess):v("error",t.wpstgObject.i18n.dbConnectionFailed+" <br/> Error: "+s)})).catch((function(n){return t.isDbConnected=!1,t.setDbCallStatus(!1),v("warning",t.wpstgObject.i18n.somethingWentWrong),console.warn(t.wpstgObject.i18n.somethingWentWrong,n),e?e():""}))))},t.setDbCallStatus=function(e){if(void 0===e&&(e=!0),e)return m(this.dbConnectionTest),b("#wpstg-db-connection-running"),void(this.dbCheckCallStatus=!0);this.dbCheckCallStatus=!1,m("#wpstg-db-connection-running"),b(this.dbConnectionTest)},e}(),P=function(){function e(e,t,n){void 0===e&&(e="#wpstg-workflow"),void 0===t&&(t="#wpstg_select_tables_pushing"),void 0===n&&(n=wpstg),this.workflow=l(e),this.inputSelector=t,this.input=l(t),this.wpstgObject=n,this.cloneID=this.input.getAttribute("data-clone"),this.tablePrefix=this.input.getAttribute("data-prefix"),this.isNetwork="true"===this.input.getAttribute("data-network"),this.areAllTablesChecked=!0,this.init()}var t=e.prototype;return t.addEvents=function(){var e=this;u(document.body,"click",".wpstg-button-show-tables",(function(t){e.showAllTables()})),u(document.body,"click",".wpstg-button-db-prefix",(function(){e.selectDefaultTables()})),u(document.body,"click",".wpstg-button-unselect",(function(){e.toggleTableSelection()})),u(document.body,"change",this.inputSelector,(function(){e.countSelectedTables()}))},t.init=function(){this.addEvents()},t.showAllTables=function(){var e=this,t=this.getIncludedTables(),n=this.getExcludedTables();t.length>n.length?t="":n.length>t.length&&(n=""),fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg_push_tables",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,clone:this.cloneID,includedTables:t,excludedTables:n,selectedTablesWithoutPrefix:this.getSelectedTablesWithoutPrefix()}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(t){if(void 0!==t.success&&t.success)return e.input.innerHTML=t.content,g(l(".wpstg-button-show-tables"),300),void e.countSelectedTables();void 0===t.message?e.notyf.error(e.wpstgObject.i18n.somethingWentWrong):e.notyf.error(t.message)})).catch((function(t){console.warn(e.wpstgObject.i18n.somethingWentWrong,t)}))},t.getRegexPattern=function(){var e="^"+this.tablePrefix;return"1"!==this.wpstgObject.isMultisite||this.isNetwork||(e+="([^0-9])_*"),e},t.selectDefaultTables=function(){var e=this.input.querySelectorAll(".wpstg-db-table"),t=this.getRegexPattern();e.forEach((function(e){var n=e.getAttribute("name",""),s=e.hasAttribute("disabled");n.match(t)&&!s?e.selected=!0:e.selected=!1})),this.countSelectedTables()},t.toggleTableSelection=function(){!1===this.areAllTablesChecked?(this.input.querySelectorAll(".wpstg-db-table").forEach((function(e){e.selected=!0})),this.workflow.querySelector(".wpstg-button-unselect").innerHTML="Unselect All",this.areAllTablesChecked=!0):(this.input.querySelectorAll(".wpstg-db-table").forEach((function(e){e.selected=!1})),this.workflow.querySelector(".wpstg-button-unselect").innerHTML="Select All",this.areAllTablesChecked=!1),this.countSelectedTables()},t.getSelectedTablesWithoutPrefix=function(){var e=[],t=this.getRegexPattern();return this.input.querySelectorAll("option:checked").forEach((function(n){var s=n.getAttribute("name","");s.match(t)||e.push(s)})),e.join(this.wpstgObject.settings.directorySeparator)},t.getIncludedTables=function(){var e=[],t=this.getRegexPattern();return this.input.querySelectorAll("option:checked").forEach((function(n){var s=n.getAttribute("name","");s.match(t)&&e.push(s)})),e.join(this.wpstgObject.settings.directorySeparator)},t.getExcludedTables=function(){var e=[],t=this.getRegexPattern();return this.input.querySelectorAll("option:not(:checked)").forEach((function(n){var s=n.getAttribute("name","");s.match(t)&&e.push(s)})),e.join(this.wpstgObject.settings.directorySeparator)},t.countSelectedTables=function(){var e=this.input.querySelectorAll("option:checked").length,t=l("#wpstg-tables-count");0===e?(t.classList.add("danger"),t.innerHTML=this.wpstgObject.i18n.noTableSelected):(t.classList.remove("danger"),t.innerHTML=this.wpstgObject.i18n.tablesSelected.replace("{d}",e))},e}(),j=function(){function e(e,t,n,s){void 0===e&&(e="#wpstg-workflow"),void 0===t&&(t="#wpstg-scanning-files"),void 0===n&&(n=".wpstg-check-dir"),void 0===s&&(s=wpstg),this.workflow=l(e),this.filesTabSelector=t,this.filesTab=l(t),this.dirSelector=n,this.wpstgObject=s,this.init()}var t=e.prototype;return t.addEvents=function(){var e=this;u(this.workflow,"change",this.filesTabSelector+" "+this.dirSelector,(function(t){e.toggleChildren(t),e.countSelectedFiles()}))},t.init=function(){this.addEvents()},t.toggleChildren=function(e){w(e,".wpstg-dir")[0].querySelectorAll(".wpstg-subdir>.wpstg-dir>.wpstg--checkbox-wrapper >"+this.dirSelector).forEach((function(t){t.checked=e.checked}))},t.countSelectedFiles=function(){var e=this,t=this.filesTab.querySelectorAll(this.dirSelector+":checked").length,n=l("#wpstg-files-count");if(0===t)n.classList.add("danger"),n.innerHTML=this.wpstgObject.i18n.noFileSelected;else{var s=0,o=0;n.classList.remove("danger"),this.filesTab.querySelectorAll(".wpstg-dir:not(.wpstg-sub-dir)> .wpstg-push-expand-dirs").forEach((function(t){"plugins"===t.innerHTML&&(o=t.nextSibling.querySelectorAll(e.dirSelector+":checked").length),"themes"===t.innerHTML&&(s=t.nextSibling.querySelectorAll(e.dirSelector+":checked").length)})),n.innerHTML=this.wpstgObject.i18n.filesSelected.replace("{t}",s).replace("{p}",o)}},e}(),B=function(){function e(e){void 0===e&&(e=wpstg),this.wpstgObject=e}var t=e.prototype;return t.showModal=function(){return this.loadModal()},t.loadModal=function(){return c.getSwalModal(!1,{container:"wpstg-swal2-container wpstg-swal2-loading wpstg-swal2-loading-sm"}).fire({title:"",icon:"warning",html:this.getAjaxLoader(),width:"100px",focusConfirm:!1,showConfirmButton:!1,showCancelButton:!1})},t.getAjaxLoader=function(){return'<div class="wpstg-swal2-ajax-loader"><span class="wpstg-loader"></span></div>'},e}(),D=function(){function t(){}return t.prototype.fetchWithTimeout=function(){var t=n(e().mark((function t(n,o){var r,a,i,c,l;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===o&&(o={}),r=o.timeout,a=void 0===r?8e3:r,i=new AbortController,c=setTimeout((function(){return i.abort()}),a),e.next=6,fetch(n,s({},o,{signal:i.signal}));case 6:return l=e.sent,clearTimeout(c),e.abrupt("return",l);case 9:case"end":return e.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),t}(),A=function(){function t(e,t,n,s,o,r,a,i,c,u,d,p,g,h){void 0===e&&(e="#wpstg-btn-provider-revoke"),void 0===t&&(t="#wpstg-provider-revoke-form"),void 0===n&&(n="wpstg-provider-revoke"),void 0===s&&(s="#wpstg-btn-save-provider-settings"),void 0===o&&(o="#wpstg-provider-settings-form"),void 0===r&&(r="wpstg-provider-settings"),void 0===a&&(a="#wpstg-btn-provider-authenticate"),void 0===i&&(i="#wpstg-provider-authenticate-form"),void 0===c&&(c="wpstg-provider-authenticate"),void 0===u&&(u="#wpstg-btn-provider-test-connection"),void 0===d&&(d="#wpstg-provider-test-connection-fields"),void 0===p&&(p="wpstg-provider-test-connection"),void 0===g&&(g=wpstg),void 0===h&&(h="#wpstg-btn-delete-provider-settings"),this.network=new D,this.revokeButtonSelector=e,this.revokeForm=l(t),this.revokeAction=n,this.saveSettingsButtonSelector=s,this.settingsForm=l(o),this.settingsAction=r,this.authenticateButtonSelector=a,this.authenticateForm=l(i),this.authenticateAction=c,this.testConnectionButtonSelector=u,this.testConnectionFields=l(d),this.testConnectionAction=p,this.wpstgObject=g,this.wpstgDeleteSettings=h,this.notyf=new Notyf({duration:5e3,position:{x:"center",y:"bottom"},dismissible:!0,types:[{type:"warning",background:"orange",icon:!1},{type:"error",background:"#e01e5a",icon:!0}]}),this.init()}var s=t.prototype;return s.addEvents=function(){var t=this;u(document.body,"click",this.revokeButtonSelector,function(){var s=n(e().mark((function n(s){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.sendRevokeRequest();case 2:case"end":return e.stop()}}),n)})));return function(e){return s.apply(this,arguments)}}()),u(document.body,"click",this.saveSettingsButtonSelector,function(){var s=n(e().mark((function n(s){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.sendSaveSettingsRequest();case 2:case"end":return e.stop()}}),n)})));return function(e){return s.apply(this,arguments)}}()),u(document.body,"click",this.authenticateButtonSelector,function(){var s=n(e().mark((function n(s){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.sendAuthenticateRequest();case 2:case"end":return e.stop()}}),n)})));return function(e){return s.apply(this,arguments)}}()),u(document.body,"click",this.testConnectionButtonSelector,function(){var s=n(e().mark((function n(s){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.sendTestConnectionRequest();case 2:case"end":return e.stop()}}),n)})));return function(e){return s.apply(this,arguments)}}()),u(document.body,"change","[name='ftp_type']",function(){var s=n(e().mark((function n(s){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.toggleSftpFields();case 2:case"end":return e.stop()}}),n)})));return function(e){return s.apply(this,arguments)}}()),u(document.body,"change","[name='s3_provider']",function(){var s=n(e().mark((function n(s){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.toggleS3GenericFields();case 2:case"end":return e.stop()}}),n)})));return function(e){return s.apply(this,arguments)}}()),u(document.body,"click",this.wpstgDeleteSettings,function(){var s=n(e().mark((function n(s){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.deleteStorageProviderSettings();case 2:case"end":return e.stop()}}),n)})));return function(e){return s.apply(this,arguments)}}())},s.init=function(){this.addEvents()},s.sendRevokeRequest=function(){var t=n(e().mark((function t(){var n,s,o;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.revokeForm.querySelector('input[name="provider"]').value,e.prev=1,e.next=4,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:this.revokeAction,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,provider:n}),headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 4:return(s=e.sent).ok||console.error("An error has occurred: "+s.status),e.next=8,s.json();case 8:if(!(o=e.sent).success){e.next=13;break}return this.notyf.success(o.message),setTimeout((function(){window.location.reload()}),3e3),e.abrupt("return");case 13:this.notyf.error(o.message),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),console.warn(e.t0);case 19:case"end":return e.stop()}}),t,this,[[1,16]])})));return function(){return t.apply(this,arguments)}}(),s.sendSaveSettingsRequest=function(){var t=n(e().mark((function t(){var n,s,o,r,a,i,c;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new B,s=n.showModal(),(o=new FormData(this.settingsForm)).append("action",this.settingsAction),o.append("accessToken",this.wpstgObject.accessToken),o.append("nonce",this.wpstgObject.nonce),r=new URLSearchParams(o),e.prev=7,e.next=10,this.network.fetchWithTimeout(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:r,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:8e3});case 10:return(a=e.sent).ok||console.error("An error has occurred: "+a.status),e.next=14,a.json();case 14:(i=e.sent).success||this.notyf.error(i.message),i.warning?this.notyf.open({type:"warning",message:i.message}):this.notyf.success(i.message),setTimeout((function(){window.location.reload()}),2e3),e.next=25;break;case 20:e.prev=20,e.t0=e.catch(7),c="AbortError"===e.t0.name?"Could not save settings. Ensure SFTP credentials are correct! (Hostname, port...) Please try again!":e.t0.message,this.notyf.error(c),console.warn(c);case 25:return e.prev=25,s.close(),e.finish(25);case 28:case"end":return e.stop()}}),t,this,[[7,20,25,28]])})));return function(){return t.apply(this,arguments)}}(),s.sendAuthenticateRequest=function(){var t=n(e().mark((function t(){var n,s,o,r;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new FormData(this.authenticateForm)).append("action",this.authenticateAction),n.append("accessToken",this.wpstgObject.accessToken),n.append("nonce",this.wpstgObject.nonce),s=new URLSearchParams(n),e.prev=5,e.next=8,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:s,headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 8:return(o=e.sent).ok||console.error("An error has occurred: "+o.status),e.next=12,o.json();case 12:if(!(r=e.sent).success){e.next=17;break}return this.notyf.success(r.message),setTimeout((function(){window.location.reload()}),2e3),e.abrupt("return");case 17:this.notyf.error(r.message),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(5),console.warn(e.t0);case 23:case"end":return e.stop()}}),t,this,[[5,20]])})));return function(){return t.apply(this,arguments)}}(),s.sendTestConnectionRequest=function(){var t=n(e().mark((function t(){var n,s,o,r,a,i,c,l;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new B,s=n.showModal(),o=this.testConnectionFields.querySelectorAll("[name]"),(r=new FormData).append("action",this.testConnectionAction),r.append("accessToken",this.wpstgObject.accessToken),r.append("nonce",this.wpstgObject.nonce),o.forEach((function(e){"check"!==e.type&&"checkbox"!==e.type?r.append(e.getAttribute("name"),e.value):r.append(e.getAttribute("name"),e.checked)})),a=new URLSearchParams(r),e.prev=9,e.next=12,this.network.fetchWithTimeout(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:a,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:8e3});case 12:return(i=e.sent).ok||console.error("An error has occurred: "+i.status),e.next=16,i.json();case 16:if(!(c=e.sent).success){e.next=20;break}return this.notyf.success(c.message),e.abrupt("return");case 20:this.notyf.error(c.message),e.next=27;break;case 23:e.prev=23,e.t0=e.catch(9),l="AbortError"===e.t0.name?"No response from server! Ensure SFTP credentials are correct! (Hostname, port...) Please try again!":e.t0.message,this.notyf.error(l);case 27:return e.prev=27,s.close(),e.finish(27);case 30:case"end":return e.stop()}}),t,this,[[9,23,27,30]])})));return function(){return t.apply(this,arguments)}}(),s.deleteStorageProviderSettings=function(){var t=n(e().mark((function t(){var n,s,o,r,a;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.settingsForm.querySelector('input[name="provider"]').value,s=new B,!confirm("Are you sure you want to delete "+n+" settings?")){e.next=25;break}return o=s.showModal(),e.prev=4,e.next=7,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg-provider-delete-settings",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,provider:n}),headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 7:return(r=e.sent).ok||v("error","An error has occurred: "+r.status),e.next=11,r.json();case 11:if(!(a=e.sent).success){e.next=16;break}return v("success",a.message),setTimeout((function(){window.location.reload()}),2e3),e.abrupt("return");case 16:v("error",a.message),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(4),console.warn(e.t0);case 22:return e.prev=22,o.close(),e.finish(22);case 25:case"end":return e.stop()}}),t,this,[[4,19,22,25]])})));return function(){return t.apply(this,arguments)}}(),s.toggleSftpFields=function(){var e=document.querySelector("[name='ftp_type']"),t=document.querySelectorAll(".wpstg-only-sftp"),n=document.querySelectorAll(".wpstg-only-ftp");if("ftp"!==e.value){if(t.length)for(var s,o=r(t);!(s=o()).done;){s.value.classList.remove("hidden")}if(n.length)for(var a,i=r(n);!(a=i()).done;){a.value.classList.add("hidden")}}else{if(t.length)for(var c,l=r(t);!(c=l()).done;){c.value.classList.add("hidden")}if(n.length)for(var u,d=r(n);!(u=d()).done;){u.value.classList.remove("hidden")}}},s.toggleS3GenericFields=function(){var e=""===document.querySelector("[name='s3_provider']").value;document.getElementById("wpstg-s3-custom-provider-fields").style.display=e?"block":"none"},t}(),O=function(){function e(e,t,n){void 0===e&&(e="#wpstg-directories-listing"),void 0===t&&(t=c),void 0===n&&(n=null),this.directoryListingContainer=l(e),this.wpstgObject=t,this.dirCheckboxSelector=".wpstg-check-dir",this.dirExpandSelector=".wpstg-expand-dirs",this.unselectAllDirsSelector=".wpstg-unselect-dirs",this.selectDefaultDirsSelector=".wpstg-select-dirs-default",this.fetchChildrenAction="wpstg_fetch_dir_children",this.currentCheckboxElement=null,this.currentParentDiv=null,this.currentLoader=null,this.existingExcludes=[],this.excludedDirectories=[],this.isDefaultSelected=!1,this.notyf=n,this.init()}var t=e.prototype;return t.addEvents=function(){var e=this;null!==this.directoryListingContainer?(u(this.directoryListingContainer,"change",this.dirCheckboxSelector,(function(e,t){t.preventDefault()})),u(this.directoryListingContainer,"click",this.dirExpandSelector,(function(t,n){n.preventDefault(),e.toggleDirExpand(t)&&e.sendRequest(e.fetchChildrenAction,t)})),u(this.directoryListingContainer,"click",this.unselectAllDirsSelector,(function(){e.unselectAll()})),u(this.directoryListingContainer,"click",this.selectDefaultDirsSelector,(function(){e.selectDefault()})),u(this.directoryListingContainer,"click",".wpstg-expand-dirs",(function(t,n){n.preventDefault(),e.toggleDirectoryNavigation(t)})),u(this.directoryListingContainer,"change","input.wpstg-check-dir",(function(t){e.updateDirectorySelection(t)}))):console.log("Error: Unable to add directory navigation events.")},t.init=function(){this.addEvents(),this.parseExcludes()},t.toggleDirExpand=function(e){this.currentParentDiv=e.parentElement;var t=h(e,"span");return this.currentCheckboxElement=t.querySelector('input[type="checkbox"]'),this.currentLoader=this.currentParentDiv.querySelector(".wpstg-is-dir-loading"),"false"!==this.currentCheckboxElement.getAttribute("data-navigatable","false")&&"false"===this.currentCheckboxElement.getAttribute("data-scanned","false")},t.sendRequest=function(e){var t=this;null!==this.currentLoader&&(this.currentLoader.style.display="inline-block");var n=this.currentCheckboxElement.getAttribute("data-changed"),s=this.currentCheckboxElement.getAttribute("data-path"),o=this.currentCheckboxElement.getAttribute("data-prefix");fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:e,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,dirPath:s,prefix:o,isChecked:this.currentCheckboxElement.checked,forceDefault:"true"===n}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){if(void 0!==e.success&&e.success){t.currentCheckboxElement.setAttribute("data-scanned",!0);var n=document.createElement("div");return n.classList.add("wpstg-dir"),n.classList.add("wpstg-subdir"),n.innerHTML=JSON.parse(e.directoryListing),t.currentParentDiv.appendChild(n),null!==t.currentLoader&&(t.currentLoader.style.display="none"),void d(n)}null!==t.notyf?t.notyf.error(t.wpstgObject.i18n.somethingWentWrong):alert("Error: "+t.wpstgObject.i18n.somethingWentWrong)})).catch((function(e){console.warn(t.wpstgObject.i18n.somethingWentWrong,e)}))},t.getExcludedDirectories=function(){var e,t=this;return this.excludedDirectories=[],this.directoryListingContainer.querySelectorAll(".wpstg-dir .wpstg--checkbox-wrapper input:not(:checked)").forEach((function(e){t.isParentExcluded(e.value)||t.excludedDirectories.push(e.value)})),this.existingExcludes||(this.existingExcludes=[]),this.existingExcludes.forEach((function(e){t.isParentExcluded(e)||t.isScanned(e)||t.excludedDirectories.push(e)})),this.excludedDirectories.join(null==(e=this.wpstgObject.settings)?void 0:e.directorySeparator)},t.isParentExcluded=function(e){var t=!1;return this.excludedDirectories.forEach((function(n){e.startsWith(n+"/")&&(t=!0)})),t},t.getExtraDirectoriesRootOnly=function(){this.getExcludedDirectories();var e=[];this.directoryListingContainer.querySelectorAll(":not(.wpstg-subdir)>.wpstg-dir .wpstg--checkbox-wrapper>input.wpstg-wp-non-core-dir:checked").forEach((function(t){e.push(t.value)}));var t,n=l("#wpstg_extraDirectories");if(null===n||""===n.value)return e.join(null==(t=this.wpstgObject.settings)?void 0:t.directorySeparator);var s=n.value.split(/\r?\n/);return e.concat(s).join(this.wpstgObject.settings.directorySeparator)},t.unselectAll=function(){this.directoryListingContainer.querySelectorAll(".wpstg-dir .wpstg--checkbox-wrapper input").forEach((function(e){e.checked=!1})),this.countSelectedFiles()},t.selectDefault=function(){this.unselectAll(),this.directoryListingContainer.querySelectorAll(".wpstg-dir .wpstg--checkbox-wrapper input.wpstg-wp-core-dir").forEach((function(e){e.checked=!0})),this.directoryListingContainer.querySelectorAll(".wpstg-dir > .wpstg--checkbox-wrapper .wpstg-wp-non-core-dir").forEach((function(e){e.parentElement.querySelectorAll("input.wpstg-wp-core-dir").forEach((function(e){e.checked=!1}))})),this.isDefaultSelected=!0,this.countSelectedFiles()},t.parseExcludes=function(){if(this.existingExcludes=this.directoryListingContainer.getAttribute("data-existing-excludes",[]),void 0!==this.existingExcludes&&this.existingExcludes)if(0!==this.existingExcludes.length){var e=this.existingExcludes.split(",");this.existingExcludes=e.map((function(e){return"/"===e.substr(0,1)?e.slice(1):e}))}else this.existingExcludes=[];else this.existingExcludes=[]},t.isScanned=function(e){var t=!1;return this.directoryListingContainer.querySelectorAll(".wpstg-dir> .wpstg--checkbox-wrapper>input").forEach((function(n){n.value===e&&(t=!0)})),t},t.toggleDirectoryNavigation=function(e){var t=h(e,"span"),n=t.querySelector('input[type="checkbox"]');if("false"!==n.getAttribute("data-navigatable","false")&&"false"!==n.getAttribute("data-scanned","false")){var s=function(e,t){for(var n=e.nextElementSibling;n;){if(n.matches(t))return n;n=n.nextElementSibling}}(t,".wpstg-subdir");"none"===s.style.display?d(s):p(s)}},t.updateDirectorySelection=function(e){var t=e.parentElement.parentElement;e.setAttribute("data-changed","true"),e.checked?(w(t.parentElement,".wpstg-dir").forEach((function(e){for(var t=0;t<e.children.length;t++)e.children[t].matches(".wpstg--checkbox-wrapper")&&(e.children[t].children[t].checked=!0)})),t.parentElement.querySelectorAll(".wpstg-expand-dirs").forEach((function(e){"wp-admin"!==e.textContent&&"wp-includes"!==e.textContent&&e.classList.remove("disabled")})),t.querySelectorAll(".wpstg-subdir .wpstg-check-dir").forEach((function(e){e.checked=!0}))):(t.querySelectorAll(".wpstg-expand-dirs, .wpstg-check-subdirs").forEach((function(e){e.classList.add("disabled")})),t.querySelectorAll(".wpstg-dir .wpstg-check-dir").forEach((function(e){e.checked=!1}))),this.countSelectedFiles()},t.countSelectedFiles=function(){var e=this.directoryListingContainer.querySelectorAll('[data-dir-type="theme"]:checked').length,t=this.directoryListingContainer.querySelectorAll('[data-dir-type="plugin"]:checked').length,n=l("#wpstg-files-count");0===e&&0===t?(n.classList.add("danger"),n.innerHTML=this.wpstgObject.i18n.noFileSelected):(n.classList.remove("danger"),n.innerHTML=this.wpstgObject.i18n.filesSelected.replace("{t}",e).replace("{p}",t))},e}(),M=function(){function t(){this.generateLoginLink()}return t.prototype.generateLoginLink=function(){var s=new Notyf({duration:4e3,position:{x:"center",y:"bottom"},dismissible:!0});u(document.body,"click",".wpstg-generate-login-link-action",(function(e){WPStaging.ajax({action:"wpstg_render_login_link_user_interface",clone:e.getAttribute("data-clone"),cloneName:e.getAttribute("data-name"),accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){l("#wpstg-workflow").innerHTML=e}),"HTML")})),u(document.body,"click","#wpstg-generate-login-link",function(){var o=n(e().mark((function n(o){var r,a,i,c,u,d,p,g,h,w;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="<p class='wpstg-push-confirmation-message'> "+o.getAttribute("data-alert-body")+"</p>",e.next=3,f(o.getAttribute("data-alert-title"),r,o.getAttribute("data-confirm-btn-text"),"wpstg-confirm-link-save");case 3:if(e.sent.value){e.next=6;break}return e.abrupt("return");case 6:return i=l((a="#wpstg-generate-login-link-")+"clone-id").value,c=l(a+"role").value,u=l(a+"minutes").value,d=l(a+"hours").value,p=l(a+"days").value,g=l(a+"generated").getAttribute("data-url"),h=Date.now().toString(),e.next=16,t.saveGeneratedLinkData({cloneID:i,role:c,days:p,hours:d,minutes:u,uniqueId:h});case 16:(w=e.sent).success?(l("#wpstg-generate-login-link-head").style.display="contents",l("#wpstg-generate-login-link-generated").innerText=g+h,s.success(w.data.message)):s.error(w.data.message);case 18:case"end":return e.stop()}}),n)})));return function(e){return o.apply(this,arguments)}}()),u(document.body,"mouseover","#wpstg-generate-login-link-generated-container",(function(e){l("#wpstg-generate-login-link-copy-text").innerText=l("#wpstg-generate-login-link-copy-text").getAttribute("data-copy"),l("#wpstg-generate-login-link-copy-text").style.display="contents"})),u(document.body,"mouseout","#wpstg-generate-login-link-generated-container",(function(e){l("#wpstg-generate-login-link-copy-text").style.display="none"})),u(document.body,"click","#wpstg-generate-login-link-generated-container",(function(e){navigator.clipboard.writeText(l("#wpstg-generate-login-link-generated").innerText),l("#wpstg-generate-login-link-copy-text").innerText=l("#wpstg-generate-login-link-copy-text").getAttribute("data-copied")}))},t.saveGeneratedLinkData=function(){var t=n(e().mark((function t(n){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var t=n.cloneID,s=n.role,o=n.days,r=n.hours,a=n.minutes,i=n.uniqueId;WPStaging.ajax({action:"wpstg_save_generated_link_data",accessToken:wpstg.accessToken,nonce:wpstg.nonce,cloneID:t,role:s,minutes:a,hours:r,days:o,uniqueId:i},(function(t){e(t)}),"json")})));case 1:case"end":return e.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),t}(),I=function(){function e(){this.syncAccount()}var t=e.prototype;return t.syncAccount=function(){var e=this;u(document.body,"click",".wpstg-clone-actions",(function(t){var n,s,o;l(".wpstg-sync-account")&&(n="wpstg-sync-account",s=function(t){t.preventDefault();var n=this.dataset,s="<p class='wpstg-push-confirmation-message'> "+n.alertBody+"</p>";e.confirmModal(n.alertTitle,s,n.confirmBtnText,"wpstg-confirm-sync-account").then((function(e){var t=n.clone;e.value&&WPStaging.ajax({action:"wpstg_sync_account",accessToken:wpstg.accessToken,nonce:wpstg.nonce,clone:t},(function(e){e.data.message&&(e.success?c.showSuccessModal(e.data.message):c.showErrorModal(e.data.message))}),"json",!1)}))},(o=document.querySelectorAll("."+n)).length?o.forEach((function(e){e.addEventListener("click",s)})):console.warn("No elements found with class: "+n))}))},t.confirmModal=function(e,t,n,s){return c.getSwalModal(!1,{container:"wpstg-swal-push-container",confirmButton:s+" wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn"}).fire({title:e,icon:"warning",html:t,width:"750px",focusConfirm:!1,confirmButtonText:n,showCancelButton:!0})},e}(),R=function(e){var t,n=Object.prototype,s=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function u(e,t,n,s){var r=t&&t.prototype instanceof m?t:m,a=Object.create(r.prototype),i=new B(s||[]);return o(a,"_invoke",{value:T(e,n,i)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var p="suspendedStart",g="suspendedYield",h="executing",w="completed",f={};function m(){}function b(){}function v(){}var y={};l(y,a,(function(){return this}));var k=Object.getPrototypeOf,S=k&&k(k(D([])));S&&S!==n&&s.call(S,a)&&(y=S);var x=v.prototype=m.prototype=Object.create(y);function C(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function n(o,r,a,i){var c=d(e[o],e,r);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==typeof u&&s.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,a,i)}),(function(e){n("throw",e,a,i)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,s){function o(){return new t((function(t,o){n(e,s,t,o)}))}return r=r?r.then(o,o):o()}})}function T(e,t,n){var s=p;return function(o,r){if(s===h)throw new Error("Generator is already running");if(s===w){if("throw"===o)throw r;return A()}for(n.method=o,n.arg=r;;){var a=n.delegate;if(a){var i=L(a,n);if(i){if(i===f)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(s===p)throw s=w,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);s=h;var c=d(e,t,n);if("normal"===c.type){if(s=n.done?w:g,c.arg===f)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(s=w,n.method="throw",n.arg=c.arg)}}}function L(e,n){var s=n.method,o=e.iterator[s];if(o===t)return n.delegate=null,"throw"===s&&e.iterator.return&&(n.method="return",n.arg=t,L(e,n),"throw"===n.method)||"return"!==s&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+s+"' method")),f;var r=d(o,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,f;var a=r.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,f):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,f)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function B(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function D(e){if(e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,r=function n(){for(;++o<e.length;)if(s.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return r.next=r}}return{next:A}}function A(){return{value:t,done:!0}}return b.prototype=v,o(x,"constructor",{value:v,configurable:!0}),o(v,"constructor",{value:b,configurable:!0}),b.displayName=l(v,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,l(e,c,"GeneratorFunction")),e.prototype=Object.create(x),e},e.awrap=function(e){return{__await:e}},C(E.prototype),l(E.prototype,i,(function(){return this})),e.AsyncIterator=E,e.async=function(t,n,s,o,r){void 0===r&&(r=Promise);var a=new E(u(t,n,s,o),r);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},C(x),l(x,c,"Generator"),l(x,a,(function(){return this})),l(x,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var s in t)n.push(s);return n.reverse(),function e(){for(;n.length;){var s=n.pop();if(s in t)return e.value=s,e.done=!1,e}return e.done=!0,e}},e.values=D,B.prototype={constructor:B,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(j),!e)for(var n in this)"t"===n.charAt(0)&&s.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(s,o){return i.type="throw",i.arg=e,n.next=s,o&&(n.method="next",n.arg=t),!!o}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],i=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=s.call(a,"catchLoc"),l=s.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&s.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=e,a.arg=t,r?(this.method="next",this.next=r.finallyLoc,f):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),j(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var s=n.completion;if("throw"===s.type){var o=s.arg;j(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,s){return this.delegate={iterator:D(e),resultName:n,nextLoc:s},"next"===this.method&&(this.arg=t),f}},e}("object"==typeof module?module.exports:{});try{regeneratorRuntime=R}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=R:Function("r","regeneratorRuntime = r")(R)}var _,U,q=function(){function e(e,t){void 0===e&&(e="contact-us"),void 0===t&&(t=wpstg),this.wpstgObject=t,this.characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",this.currentDate=new Date,this.modalType=e,this.init()}var t=e.prototype;return t.init=function(){this.contactUsModal="#wpstg-"+this.modalType+"-modal",this.askInTheForumForm=this.contactUsModal+" #wpstg-"+this.modalType+"-report-issue-form",this.contactUsSuccessPopup=this.contactUsModal+" #wpstg-"+this.modalType+"-success-form",this.contactUsLoader=this.contactUsModal+" #wpstg-"+this.modalType+"-report-issue-loader",this.contactUsSupport=this.contactUsModal+" #wpstg-"+this.modalType+"-support-forum",this.contactUsButton=document.querySelector("#wpstg-"+this.modalType+"-button"),this.contactUsButtonBackupTab=document.querySelector("#wpstg--tab--backup  #wpstg-"+this.modalType+"-button"),this.reportIssueButton=document.querySelector("#wpstg-contact-us-report-issue"),this.successForm=document.querySelector(this.contactUsModal+" #wpstg-"+this.modalType+"-success-form"),this.contactUsReportIssueBtn=document.querySelector(this.contactUsModal+" #wpstg-"+this.modalType+"-report-issue-btn"),this.contactUsCloseButton=document.querySelector(this.contactUsModal+" #wpstg-modal-close"),this.contactUsSuccessPopupClose=document.querySelector(this.contactUsModal+" #wpstg-"+this.modalType+"-success-modal-close"),this.debugCodeCopyButton=document.querySelector(this.contactUsModal+" #wpstg-"+this.modalType+"-debug-code-copy"),this.contactUsResponse=document.querySelector(this.contactUsModal+" #wpstg-"+this.modalType+"-debug-response"),this.contactUsDebugCodeField=document.querySelector(this.contactUsModal+" #wpstg-"+this.modalType+"-debug-code"),this.contactUsForceSendDebugLogContainer=".wpstg-contact-us-force-send-email-container",this.contactUsForceSendDebugLog=document.querySelector("#wpstg-force-send-debug-log"),this.isDebugWindowOpened=!1,this.addEvents()},t.addEvents=function(){var e=this;document.addEventListener("keydown",(function(t){"Escape"===t.key&&(m(e.contactUsModal),m(e.askInTheForumForm),m(e.contactUsSuccessPopup),m(e.contactUsSupport),e.isDebugWindowOpened=!1)})),null!==this.contactUsButton&&this.contactUsButton.addEventListener("click",(function(){b(e.contactUsModal)})),null!==this.contactUsButtonBackupTab&&this.contactUsButtonBackupTab.addEventListener("click",(function(){b(e.contactUsModal)})),null!==this.reportIssueButton&&this.reportIssueButton.addEventListener("click",(function(){e.isDebugWindowOpened?m(e.askInTheForumForm):b(e.askInTheForumForm),e.isDebugWindowOpened=!e.isDebugWindowOpened})),null!==this.contactUsReportIssueBtn&&this.contactUsReportIssueBtn.addEventListener("click",(function(){e.sendDebugInfo()})),null!==this.contactUsSuccessPopupClose&&this.contactUsSuccessPopupClose.addEventListener("click",(function(){m(e.contactUsSuccessPopup)})),null!==this.contactUsCloseButton&&this.contactUsCloseButton.addEventListener("click",(function(){m(e.contactUsModal),m(e.contactUsSupport),m(e.askInTheForumForm),e.isDebugWindowOpened=!1})),null!==this.debugCodeCopyButton&&this.debugCodeCopyButton.addEventListener("click",(function(){e.copyDebugCode(),v("success","Debug code copied to clipboard")}))},t.copyDebugCode=function(){this.contactUsDebugCodeField.select(),this.contactUsDebugCodeField.setSelectionRange(0,99999),navigator.clipboard.writeText(this.contactUsDebugCodeField.value)},t.generateDebugCode=function(e){for(var t="",n=0;n<e;n++)t+=this.characters.charAt(Math.floor(Math.random()*this.characters.length));return"wpstg-"+t+"-"+this.currentDate.getHours()+this.currentDate.getMinutes()+this.currentDate.getSeconds()},t.sendDebugInfo=function(){var e=this;b(this.contactUsLoader),this.contactUsReportIssueBtn.disabled=!0;var t=this.generateDebugCode(8),n=!1;this.contactUsForceSendDebugLog&&(n=this.contactUsForceSendDebugLog.checked),fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg_send_debug_log_report",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,debugCode:t,forceSend:n}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(t){if(e.contactUsReportIssueBtn.disabled=!1,t.ok)return t.json()})).then((function(n){var s,o;!0===(null==(s=n.response)?void 0:s.sent)&&(e.contactUsDebugCodeField.value=t,b(e.contactUsSuccessPopup),window.debugCode=t,m(e.contactUsForceSendDebugLogContainer),e.contactUsForceSendDebugLog.checked=!1),!1===(null==(o=n.response)?void 0:o.sent)&&"already_submitted"===n.response.status&&(b(e.contactUsForceSendDebugLogContainer),v("error",n.response.message)),m(e.contactUsLoader)})).catch((function(t){m(e.contactUsLoader),b(e.contactUsSupport),console.warn(e.wpstgObject.i18n.somethingWentWrong,t)}))},e}(),F=new(function(){function e(){this.wrap="",this.tempHidden="",this.tempHiddenTimeout="",this.callbackOnHide=null}var t=e.prototype;return t.setCallbackOnHide=function(e){this.callbackOnHide=e},t.shows=function(){this.wrap=document.getElementById("wpstg-auth-check-wrap"),this.parentElement=document.getElementById("wpstg-auth-check"),this.formElement=document.getElementById("wpstg-auth-check-form"),this.wrapElement=document.getElementById("wpstg-auth-check-wrap"),this.noFrameElement=this.wrapElement.querySelector(".wpstg-auth-fallback-expired"),this.iframeElement="",this.isIframeLoaded=!1,this.formElement&&(this.addUnloadEvent(),this.iframeElement=this.createIframeElement(),this.formElement.appendChild(this.iframeElement)),this.openModal(),this.iframeElement?(this.focusIframe(),this.setIframeLoadTimeout()):this.focusFallbackElement()},t.addUnloadEvent=function(){window.addEventListener("beforeunload",(function(e){e.returnValue="Your session has expired. You can log in again from this page or go to the login page."}))},t.createIframeElement=function(){var e=this;return this.iframeElement=document.createElement("iframe"),this.iframeElement.id="wpstg-auth-check-frame",this.iframeElement.style.border="0px",this.iframeElement.title=this.noFrameElement.textContent,this.iframeElement.onload=function(){return e.handleIframeLoad()},this.iframeElement.src=this.formElement.dataset.src,this.iframeElement},t.handleIframeLoad=function(){var e,t;this.isIframeLoaded=!0,this.formElement.classList.remove("loading");try{e=(t=this.iframeElement.contentDocument.querySelector("body")).offsetHeight}catch(e){return void this.handleIframeLoadError()}t&&e?t.classList.contains("interim-login-success")?this.hide():this.parentElement.style.maxHeight=e+40+"px":this.handleIframeLoadError()},t.handleIframeLoadError=function(){this.wrapElement.classList.add("fallback"),this.parentElement.style.maxHeight="",this.formElement.remove(),this.noFrameElement.focus()},t.openModal=function(){document.body.classList.add("modal-open"),this.wrapElement.classList.remove("hidden")},t.focusIframe=function(){this.iframeElement.focus()},t.setIframeLoadTimeout=function(){var e=this;setTimeout((function(){e.isIframeLoaded||(e.wrapElement.classList.add("fallback"),e.formElement.remove(),e.noFrameElement.focus())}),2e3)},t.focusFallbackElement=function(){this.noFrameElement.focus()},t.hide=function(){window.removeEventListener("beforeunload",(function(e){e.returnValue=null})),g(this.wrap,200),this.callbackOnHide&&this.callbackOnHide()},e}()),W=function(){function t(e){void 0===e&&(e=wpstg),this.wpstgObject=e,this.count=0,this.status=!0,this.isAuthenticated=!0}var s=t.prototype;return s.start=function(){var e=this;this.status&&setTimeout((function(){e.checkUserAuthentication()}),1e3)},s.stop=function(){this.resetCount(),this.status=!1},s.resetCount=function(){this.count=0},s.checkUserAuthentication=function(){var t=n(e().mark((function t(){var n=this;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg_check_user_is_authenticated",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){if(!1===e.wpAuthCheck&&n.count++,n.isAuthenticated=e.wpAuthCheck,2===n.count)return n.stop(),void n.createAuthCheckElements(e.redirectUrl);n.start()})).catch((function(e){console.error("Error:",e)}));case 1:case"end":return e.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),s.createAuthCheckElements=function(e){var t=this;null!==document.getElementById("wpstg-auth-check-wrap")&&document.getElementById("wpstg-auth-check-wrap").remove();var n=document.createElement("div");n.id="wpstg-auth-check-wrap",n.classList.add("hidden");var s=document.createElement("div");s.id="wpstg-auth-check-bg";var o=document.createElement("div");o.id="wpstg-auth-check";var r=document.createElement("div");r.id="wpstg-auth-check-form",r.classList.add("loading"),r.dataset.src=e+"?interim-login=1&wp_lang=en_US";var a=document.createElement("div");a.classList.add("wpstg-auth-fallback");var i=document.createElement("p");i.innerHTML='<b class="wpstg-auth-fallback-expired" tabindex="0">Session expired</b>';var c=document.createElement("p");c.innerHTML='<a href="'+e+'" target="_blank">Please log in again.</a> The login page will open in a new tab. After logging in you can close it and return to this page.';var l=document.createElement("button");l.type="button",l.classList.add("wpstg-auth-check-close","button-link"),l.innerHTML='<span class="screen-reader-text">Close dialog</span>',l.addEventListener("click",(function(){n.classList.add("hidden")})),o.append(l,r,a),a.append(i,c),n.append(s,o),document.body.appendChild(n),F.setCallbackOnHide((function(){t.checkUserAuthentication()})),F.shows()},t}(),N=new W;U=jQuery,window.addEventListener("backups-tab",(function(){var e=l("#wpstg--tab--backup");e.style.minHeight=e.offsetHeight,_.fetchListing()})),window.addEventListener("backupListingFinished",(function(){fetch(ajaxurl+"?action=wpstg--backups--restore--file-list&_="+Math.random()+"&withTemplate=true",{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg--backups--restore--file-list",accessToken:wpstg.accessToken,nonce:wpstg.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(c.handleFetchErrors).then((function(e){return e.json()})).then((function(e){void 0!==e.success&&!1===e.success&&c.showError("Error: "+e.data);var t=document.querySelector(".wpstg-backup-list ul");t&&(t.innerHTML=e,E(t)),x("hidden"),document.getElementById("wpstg--tab--backup").style.minHeight="max-content",u(l("#wpstg-existing-backups"),"click",".wpstg-tab-header",(function(e,t){var n=l(e.getAttribute("data-id"));e.classList.toggle("expand"),e.classList.contains("expand")?(e.querySelector("span").classList.add("wpstg-rotate-90"),d(n)):(e.querySelector("span").classList.remove("wpstg-rotate-90"),p(n)),t.stopImmediatePropagation()}))})).catch((function(e){return c.showAjaxFatalError(e,"","Submit an error report.")}))})),window.addEventListener("finishedProcess",(function(){window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)})),window.addEventListener("finishedProcessWithError",(function(){window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)}));var H,G=_={performingCancelRequest:!1,isBackupSlowerThanUsual:!1,isBackupSpeedModalDisplayed:!1,isCancelled:!1,isFinished:!1,processInfo:{title:null,interval:null,isOnlySchedule:!1,isBackupCreationInBackground:!1},modal:{create:{html:null,confirmBtnTxt:null,hasBackupSchedule:null},process:{html:null,cancelBtnTxt:null,modal:null},download:{html:null,data:{indexFile:null,files:[]}},upload:{html:null,confirmBtnTxt:null,retryCount:0,data:{file:null}},restore:{html:null,btnTxtNext:null,btnTxtConfirm:null,btnTxtCancel:null,searchReplaceForm:null,containerIntroduction:null,data:{file:null,fileObject:null,search:[],replace:[],backupMetadata:{}},baseDirectory:null}},messages:{WARNING:"warning",ERROR:"error",INFO:"info",DEBUG:"debug",CRITICAL:"critical",data:{all:[],info:[],error:[],critical:[],warning:[],debug:[]},shouldWarn:function(){return _.messages.data.error.length>0||_.messages.data.critical.length>0},countByType:function(e){return void 0===e&&(e=_.messages.ERROR),_.messages.data[e].length},addMessage:function(e){if(Array.isArray(e))e.forEach((function(e){_.messages.addMessage(e)}));else if(e.type){var t=e.type.toLowerCase()||"info";_.messages.data[t]||(_.messages.data[t]=[]),_.messages.data.all.push(e),_.messages.data[t].push(e)}},reset:function(){_.messages.data={all:[],info:[],error:[],critical:[],warning:[],debug:[]}}},timer:{totalSeconds:0,interval:null,start:function(){null===_.timer.interval&&(_.timer.interval=setInterval((function(){var e;U(".wpstg-backup-process-elapsed-time").text((e=_.timer.totalSeconds,""+new Date(1e3*e).toISOString().substr(11,8))),N.isAuthenticated&&_.timer.totalSeconds++}),1e3))},stop:function(){_.timer.totalSeconds=0,_.timer.interval&&(clearInterval(_.timer.interval),_.timer.interval=null)}},status:{hasResponse:null,reTryAfter:5e3},fetchListing:function(e){return void 0===e&&(e=!0),c.isLoading(!0),U("#backup-messages").text(""),e&&c.resetErrors(),fetch(ajaxurl+"?action=wpstg--backups--listing&_="+Math.random(),{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg--backups--listing",accessToken:wpstg.accessToken,nonce:wpstg.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(c.handleFetchErrors).then((function(e){return e.json()})).then((function(e){var t=l("#wpstg--tab--backup");return t.style.minHeight=t.offsetHeight+"px",U("#wpstg--tab--backup").empty(),_.modal.create.html=null,c.cache.get("#wpstg--tab--backup").html(e),void 0!==e.success&&!1===e.success?(c.showError("Error: "+e.data),void x("hidden")):(c.showAjaxFatalError(e,"","Submit an error report."),c.isLoading(!1),window.dispatchEvent(new Event("backupListingFinished")),U("#local-backup-title").show(),U("#cloud-backup-title").hide(),e)})).catch((function(e){return c.showAjaxFatalError(e,"","Submit an error report.")}))},cancel:function(e,t){void 0===e&&(e={}),void 0===t&&(t=null),_.timer.stop(),clearInterval(_.processInfo.interval),_.isCancelled=!0,_.processInfo.interval=null,window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess),c.closeSwalModal(),c.getSwalModal(!0).fire({title:"Cancelling & Cleaning up",text:"This modal will close automatically when done...",icon:"info",showConfirmButton:!1,showCloseButton:!1,showLoaderOnConfirm:!1,showCancelButton:!1,allowEscapeKey:!1,allowOutsideClick:!1,width:650,onRender:function(){_.sendCancelRequest(Object.assign({isInit:"yes"},e),t)}})},sendCancelRequest:function(e,t){_.performingCancelRequest||(_.performingCancelRequest=!0,c.ajax(Object.assign({action:"wpstg--backups--cancel",accessToken:wpstg.accessToken,nonce:wpstg.nonce,jobIdBeingCancelled:c.getJobId()},e),(function(n){_.performingCancelRequest=!1,_.isCancelled=!1,c.showAjaxFatalError(n,"","Submit an error report."),n.hasOwnProperty("isRunning")||c.showErrorModal("Cancel process did not finish gracefully. Some temporary files might not have been cleaned up."),!1===n.isRunning?(N.stop(),c.closeSwalModal(),null!=t&&t()):(e.isInit="no",_.sendCancelRequest(e,t))}),"json",!1,1,1.25,(function(n,s,o){_.performingCancelRequest=!1,c.continueErrorHandle=!1,423!==n.status?(c.closeSwalModal(),c.showErrorModal("Cancel process did not finish gracefully. Some temporary files might not have been cleaned up."),null!=t&&t()):setTimeout((function(){_.sendCancelRequest(e,t)}),1e3)})))},process:function(e){if(!("function"==typeof e.execute||e.data&&e.onResponse))return c.closeSwalModal(),void c.showError("process.data and / or process.onResponse is not set");if(!_.modal.process.html||!_.modal.process.cancelBtnTxt){var t=U("#wpstg-backup-process-modal"),n=t.html(),s=t.attr("data-cancelButtonText");_.modal.process.html=n||null,_.modal.process.cancelBtnTxt=s||null,t.remove()}U("body").off("click",".wpstg-backup-process-logs-button").on("click",".wpstg-backup-process-logs-button",(function(e){_.showLogsInModal(e)})).off("click",".wpstg-backup-success-logs-button").on("click",".wpstg-backup-success-logs-button",(function(e){_.showLogsInModal(e,"success")})),e.isShowCancelButton=!1!==e.isShowCancelButton,_.modal.process.modal=c.getSwalModal(!0,{content:"wpstg--process--content"}).fire({html:_.modal.process.html,cancelButtonText:_.modal.process.cancelBtnTxt,showCancelButton:e.isShowCancelButton,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,width:600,onRender:function(){var t=c.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],n=t.cloneNode(!0);if(t.parentNode.replaceChild(n,t),n.addEventListener("click",(function(e){confirm("Do you want to cancel the process?")&&_.cancel()})),"function"!=typeof e.execute)return e.data&&e.onResponse?void c.ajax(e.data,e.onResponse):(c.closeSwalModal(),void c.showError("process.data and / or process.onResponse is not set"));e.execute()},onAfterClose:function(){return"function"==typeof e.onAfterClose&&e.onAfterClose()}})},processResponse:function(e){if(null===e)throw c.closeSwalModal(),c.showError("Invalid Response; null"),new Error("Invalid Response; "+e);var t=U(c.getSwalContainer());(e.title||e.statusTitle)&&t.find(".wpstg-backup-process-title").text(e.title||e.statusTitle),e.percentage&&t.find(".wpstg-backup-process-percent").text(e.percentage),_.addResponseMessagesToLog(e),e.jobId&&c.setJobId(e.jobId),!1===e.isRunning&&!0===e.job_done&&("Backup"===e.job&&_.calculateBackupSpeedIndex(e.backupSize,_.timer.totalSeconds),_.timer.stop(),_.isCancelled=!0,e.status=!e.isRunning,window.dispatchEvent(new CustomEvent("finishedProcess",{response:e})))},logsModal:function(){c.getSwalModal(!0,{popup:"wpstg-swal-popup wpstg-centered-modal"}).fire({html:'<div class="wpstg--modal--error--logs" style="display:block"></div><div class="wpstg-backup-process-logs" style="display:block"></div>',width:"97%",onRender:function(){var e=U(c.getSwalContainer());e[0].style["z-index"]=9999;var t=e.find(".wpstg-backup-process-logs"),n=e.find(".wpstg--modal--error--logs"),s=U("#wpstg--js--translations"),o=_.messages,a=s.attr("data-modal-logs-title").replace("{critical}",o.countByType(o.CRITICAL)).replace("{errors}",o.countByType(o.ERROR)).replace("{warnings}",o.countByType(o.WARNING));n.before("<h3>"+a+"</h3>");var i=[_.messages.CRITICAL,_.messages.ERROR,_.messages.WARNING];_.messages.shouldWarn()||n.hide();for(var l,u=r(o.data.all);!(l=u()).done;){var d=l.value,p="wpstg--modal--process--msg--"+d.type.toLowerCase();i.includes(d.type)&&n.append('<p class="'+p+'">['+d.type+"] - ["+d.date+"] - "+d.message+"</p>"),t.append('<p class="'+p+'">['+d.type+"] - ["+d.date+"] - "+d.message+"</p>")}},onOpen:function(e){var t=U(e).find(".wpstg-backup-process-logs");t.scrollTop(t[0].scrollHeight)}})},addResponseMessagesToLog:function(e){if(e.messages){for(var t,n=U(".wpstg-backup-process-logs"),s=[_.messages.ERROR,_.messages.CRITICAL],o=function e(t){if(Array.isArray(t))for(var o,a=r(t);!(o=a()).done;)e(o.value);else if(t.type){var i="wpstg--modal--process--msg--"+t.type.toLowerCase();n.append('<p class="'+i+'">['+t.type+"] - ["+t.date+"] - "+t.message+"</p>"),s.includes(t.type.toLowerCase())&&(window.dispatchEvent(new CustomEvent("finishedProcessWithError",{detail:{error:t.message}})),_.cancel({},(function(){setTimeout(_.logsModal,500)})))}},a=r(e.messages);!(t=a()).done;){var i=t.value;i&&(_.messages.addMessage(i),o(i))}if(n.is(":visible")&&n.scrollTop(n[0].scrollHeight),_.messages.shouldWarn()){var l=U(c.getSwalContainer()).find(".wpstg-backup-process-logs-button");l.html(l.attr("data-txt-bad")),l.find(".wpstg--modal--logs--critical-count").text(_.messages.countByType(_.messages.CRITICAL)),l.find(".wpstg--modal--logs--error-count").text(_.messages.countByType(_.messages.ERROR)),l.find(".wpstg--modal--logs--warning-count").text(_.messages.countByType(_.messages.WARNING))}}},downloadModal:function(e){var t=e.title,n=void 0===t?null:t,s=e.bodyText,o=void 0===s?null:s;if(!_.isBackupSlowerThanUsual||!1!==_.isBackupSpeedModalDisplayed){if(null===_.modal.download.html){var r=U("#wpstg-backup-success-modal");_.modal.download.html=r.html()}if(c.getSwalModal(!0).fire({icon:"success",html:_.modal.download.html.replace("{title}",n).replace("{btnTxtLog}","Show Logs").replace("{text}",null!==o?o:"You can restore this backup anytime or upload it to another website and restore it there."),confirmButtonText:"Close",showCancelButton:!1,showConfirmButton:!0}),"Backup Complete"===n){var a=c.getSwalContainer().querySelector(".wpstg-rate-us");a&&a.classList.add("show")}}},checkMemoryExhaustion:function(t,s){return n(e().mark((function n(){var o,r;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.checkMemoryExhaustion(s);case 2:if(!1!==(o=e.sent)){e.next=5;break}return e.abrupt("return");case 5:r=' <button class="wpstg-btn wpstg-primary-btn wpstg-report-issue-button" type="button">CONTACT US</button> for help in solving this issue.',wpstg.isPro&&(r=' Read <a target="_blank" href="'+c.memoryExhaustArticleLink+'">this article</a> for solving this issue. Please contact WP Staging support if you need further assistance.'),t.messages=[{type:"critical",date:o.data.time,message:o.message+"."+r}],_.processResponse(t);case 9:case"end":return e.stop()}}),n)})))()},statusStop:function(){clearInterval(_.processInfo.interval),_.processInfo.interval=null,window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)},statusStart:function(e){null===_.processInfo.interval&&(_.processInfo.interval=setInterval((function(){!0!==_.isCancelled?!1!==_.status.hasResponse&&(_.status.hasResponse=!1,fetch(ajaxurl+"?action=wpstg--backups--status&"+e+"=restore",{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg--backups--status",accessToken:wpstg.accessToken,nonce:wpstg.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.json()})).then((function(e){if(_.status.hasResponse=!0,void 0===e&&_.statusStop(),_.processInfo.title!==e.currentStatusTitle){_.processInfo.title=e.currentStatusTitle;var t=U(c.getSwalContainer());t.find(".wpstg-backup-process-title").text(e.currentStatusTitle),t.find(".wpstg-backup-process-percent").text("0")}})).catch((function(e){_.status.hasResponse=!0,c.showAjaxFatalError(e,"","Submit an error report.")}))):_.statusStop()}),5e3))},showLogsInModal:function(e,t){if(void 0===t&&(t="process"),_.messages.data.all){var n=c.getSwalContainer().querySelector(".wpstg-backup-"+t+"-logs");n.innerHTML="",_.messages.data.all.forEach((function(e){var t="wpstg--modal--process--msg--"+e.type.toLowerCase(),s=document.createElement("p");s.className=t,s.textContent="["+e.type+"] - ["+e.date+"] - "+e.message,n.appendChild(s)}))}var s=c.getSwalContainer(),o=U(s).find(".wpstg-backup-"+t+"-logs");o.toggle();var r=U(s).find(".wpstg-backup-"+t+"-logs-button");e.preventDefault(),o.is(":visible")?(r.text(wpstg.i18n.hideLogs),s.childNodes[0].style.width="97%",s.style["z-index"]=9999):(r.text(wpstg.i18n.showLogs),s.childNodes[0].style.width="600px")},calculateBackupSpeedIndex:function(e,t){fetch(ajaxurl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg_calculate_backup_speed_index",accessToken:wpstg.accessToken,nonce:wpstg.nonce,size:e,time:t}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){if(e.ok)return e.json()})).then((function(e){if(_.isBackupSlowerThanUsual=e.isBackupSlowerThanUsual,_.isBackupSpeedModalDisplayed=e.isBackupSpeedModalDisplayed,e.isBackupSlowerThanUsual&&!1===e.isBackupSpeedModalDisplayed){var t=document.querySelector("#wpstg-general-error-modal");null!=t&&null!=t&&(b("#wpstg-general-error-modal"),new q("general-error"))}})).catch((function(e){console.log(e)}))}};!function(e){H={listen:function(){e("body").on("click",".wpstg--edit-schedule",H.updateSchedule)},updateSchedule:function(e){c.resetErrors(),e.preventDefault();var t=e.target.dataset.scheduleId;c.ajax({action:"wpstg--backups-edit-schedule-modal",accessToken:wpstg.accessToken,nonce:wpstg.nonce,scheduleId:t},(function(e){c.getSwalModal(!1).fire({html:document.getElementById("wpstg--modal--edit--backup--schedules").innerHTML,showConfirmButton:!0,showCloseButton:!0,showLoaderOnConfirm:!1,showCancelButton:!0,confirmButtonText:"Save",cancelButtonText:"Cancel",width:500,allowEscapeKey:!0,allowOutsideClick:!0}).then((function(e){if(!0===e.isConfirmed){var n=c.getSwalContainer(),s={scheduleRecurrence:n.querySelector("#wpstgEditBackupScheduleRecurrence").value||null,scheduleTime:n.querySelector("#wpstgEditBackupScheduleTime").value||null,scheduleRotation:n.querySelector("#wpstgEditBackupScheduleRotation").value||null};c.ajax({action:"wpstg--backups-edit-schedule",accessToken:wpstg.accessToken,nonce:wpstg.nonce,scheduleId:t,formValues:s},(function(e){e.success?(function(e){return C.apply(this,arguments)}().then((function(){return x()})),G.fetchListing()):e.data&&c.showErrorModal(e.data)}))}})),l(".wpstg--swal2-container #wpstg--modal--edit--backup--schedules--content").innerHTML=e.data}))}}}(jQuery);var z=H,Q=function(){function t(e){void 0===e&&(e=wpstg),this.wpstgObject=e,this.action="",this.isProcessCancelled=!1,this.isProcessFinished=!1,this.processTime=0,this.processInterval="",this.modal=null,this.disableCancelButton=!1,this.title="",this.showCancelButton=!1,this.percentage=0,this.cloneId="",this.successModal="",this.showProcessLogs=!0,this.stagingSiteUrl="",this.modalType="clone"}var s=t.prototype;return s.start=function(){var e=this;(this.showCancelButton=!0,this.processInterval=setInterval((function(){(N.isAuthenticated||"wpstg_push_processing"===e.action)&&(e.processTime++,e.updateElapsedTime())}),1e3),"wpstg_delete_clone"===this.action)&&(m(".wpstg-"+this.modalType+"-process-logs-button"),this.showCancelButton=!1,c.getSwalContainer().querySelector(".wpstg-"+this.modalType+"-process-percent").textContent=100);"wpstg_cloning"!==this.action&&"wpstg_push_processing"!==this.action||(N.status=!0,N.start()),m(".wpstg-prev-step-link, #wpstg-start-updating, .wpstg-loader, #wpstg-cancel-cloning, .wpstg-log-details, .wpstg-progress-bar, #wpstg-processing-header"),m(".wpstg-processing-timer, #wpstg-cancel-pushing, .wpstg-progress-bar-wrapper, #wpstg-cancel-cloning-update, #wpstg-removing-clone")},s.stop=function(){this.processTime=0,this.modal=null,this.percentage="",this.resetCancelChecks(),clearInterval(this.processInterval),c.closeSwalModal(),y(),m("#wpstg-try-again, #wpstg-home-link, #wpstg-show-log-button, .wpstg-loader"),"wpstg_cloning"!==this.action&&"wpstg_push_processing"!==this.action||N.stop()},s.resetCancelChecks=function(){var e=this;null!==document.getElementById("wpstg-new-clone")?(setTimeout((function(){e.isProcessCancelled=!1,WPStaging.isCancelled=!1}),2e3),T()):setTimeout((function(){e.resetCancelChecks()}),1e3)},s.cancelProcess=function(){confirm("Are you sure you want to cancel cloning process?")&&(WPStaging.isCancelled=!0,this.isProcessCancelled=!0,"wpstg_push_processing"===this.action?(c.getSwalContainer().querySelector(".wpstg-"+this.modalType+"-process-title").textContent="Canceling Please wait....",this.stop(),b("#wpstg-workflow"),WPStaging.messages=[]):this.cancelCloneAction())},s.setTitle=function(e){this.title=e.job,"database"===e.job||"jobCopyDatabaseTmp"===e.job?(this.title="Copying Database",this.disableCancelButton=!1):"SearchReplace"===e.job?(this.title="Processing Data",this.disableCancelButton=!1):"PreserveDataSecondStep"===e.job||"PreserveDataFirstStep"===e.job?(this.title="Preserve Data",this.disableCancelButton=!1):"directories"===e.job||"jobFileScanning"===e.job?(this.title="Scanning Files",this.disableCancelButton=!1):"files"===e.job||"data"===e.job||"jobCopy"===e.job||"jobSearchReplace"===e.job?(this.title="Copying Files",this.disableCancelButton=!1):"Backup"===e.job?(this.title="Backup Files Scanning",this.disableCancelButton=!1):"finish"===e.job||"finished"===e.status?(this.title="Process Finished",this.disableCancelButton=!1):"jobDatabaseRename"===e.job?(this.title="Renaming Database",this.disableCancelButton=!0):"jobData"===e.job&&(this.title="Updating Database Data",this.disableCancelButton=!0)},s.setPercentage=function(e){null!==e.percentage&&(this.percentage=e.percentage)},s.initializeProcessModal=function(){var e=this,t=document.getElementById("wpstg-"+this.modalType+"-process-modal"),n=t.innerHTML;t.parentNode.removeChild(t),this.modal={html:null,cancelBtnTxt:null,processTime:0,instance:c.getSwalModal(!0,{content:"wpstg--process--content"}).fire({html:n,cancelButtonText:"Cancel",showCancelButton:this.showCancelButton,showConfirmButton:!1,showCloseButton:!1,showLoaderOnConfirm:!1,allowEscapeKey:!1,allowOutsideClick:!1,onRender:function(){var t=c.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],n=t.cloneNode(!0);t.parentNode.replaceChild(n,t),n.addEventListener("click",(function(){e.cancelProcess()}));var s=c.getSwalContainer().getElementsByClassName("wpstg-"+e.modalType+"-process-logs-button")[0],o=s.cloneNode(!0);s.parentNode.replaceChild(o,s),o.addEventListener("click",(function(t){e.renderProcessLogs("process",t)}))}})},this.start()},s.setProcessModal=function(){var e=c.getSwalContainer(),t=e.getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],n=e.querySelector(".wpstg-"+this.modalType+"-process-title"),s=e.querySelector(".wpstg-"+this.modalType+"-process-percent");n.textContent=this.title,s.textContent=this.percentage,t.disabled=this.disableCancelButton},s.openProcessModal=function(e,t,n,s){void 0===n&&(n=!1),void 0===s&&(s=!0),this.isProcessCancelled||WPStaging.isCancelled||(void 0!==e&&(this.action=e.action,this.cloneId=e.cloneID),this.showCancelButton=s,this.showLogs=n,this.modal?t.job?(this.setTitle(t),this.setPercentage(t),this.setProcessModal(),"finish"===t.job&&this.stop()):"finished"===t.status&&this.stop():(c.resetErrors(),this.initializeProcessModal()))},s.formatTimeDuration=function(){return new Date(1e3*this.processTime).toISOString().slice(11,19)+"s"},s.updateElapsedTime=function(){null!==this.processInterval&&(c.getSwalContainer().querySelector(".wpstg-"+this.modalType+"-process-elapsed-time").textContent=this.formatTimeDuration())},s.getCancelCloneAction=function(){var e=this;if(""!==this.action)return[{name:"wpstg_cloning",cancel:"wpstg_cancel_clone"},{name:"wpstg_reset",cancel:"wpstg_cancel_update"},{name:"wpstg_update",cancel:"wpstg_cancel_update"},{name:"wpstg_push_processing",cancel:"wpstg_cancel_push_processing"}].find((function(t){return t.name===e.action})).cancel},s.cancelCloneAction=function(){var e=this;this.action&&fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:this.getCancelCloneAction(),accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,clone:this.cloneId}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(t){(t&&void 0!==t.delete&&"finished"===t.delete||!0===t)&&(e.stop(),WPStaging.loadOverview(),WPStaging.messages=[]),!0!==t&&e.cancelCloneAction()})).catch((function(t){console.log(e.wpstgObject.i18n.somethingWentWrong,t)}))},s.initializeSuccessModal=function(){var t=n(e().mark((function t(n){var s=this;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setSuccessModalContent(n);case 2:this.successModal=e.sent,c.getSwalModal(!0,{confirmButton:"wpstg--btn--confirm wpstg-green-button wpstg-button wpstg-link-btn wpstg-100-width"}).fire({icon:"success",html:this.successModal.innerHTML,confirmButtonText:"Close",showCancelButton:!1,showConfirmButton:!0,allowOutsideClick:!1,onRender:function(){var e=c.getSwalContainer().getElementsByClassName("wpstg-"+s.modalType+"-success-logs-button")[0],t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",(function(e){s.renderProcessLogs("success",e)}))}}).then((function(e){e.value&&(c.closeSwalModal(),m(".wpstg-loader"),WPStaging.messages=[],"wpstg_push_processing"===s.action&&location.reload(),s.action="")})),this.showProcessLogs&&b(".wpstg-"+this.modalType+"-success-logs-wrapper"),m(".wpstg-loader"),"wpstg_delete_clone"!==this.action&&WPStaging.loadOverview();case 7:case"end":return e.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),s.setSuccessModalContent=function(){var t=n(e().mark((function t(n){var s,o,r,a,i,c,l,u;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=document.getElementById("wpstg-"+this.modalType+"-success-modal"),null!==n.title&&(s.innerHTML=s.innerHTML.replace("{title}",n.title)),this.showProcessLogs&&(s.innerHTML=s.innerHTML.replace("{btnTxtLog}",'<span style="text-decoration: underline">Show Logs</span>')),null===n.body||void 0===n.body){e.next=20;break}if(o=n.body,null===this.stagingSiteUrl){e.next=15;break}if(a=this.stagingSiteUrl,"undefined"==typeof wpstgPro||"function"!=typeof(null==(r=wpstgPro)?void 0:r.saveGeneratedLinkData)){e.next=14;break}return i=Date.now().toString(),c=this.cloneId,e.next=12,wpstgPro.saveGeneratedLinkData({cloneID:c,role:"administrator",days:"",hours:"",minutes:"5",uniqueId:i});case 12:e.sent.success&&(a=this.stagingSiteUrl+"/wp-login.php?wpstg_login="+i);case 14:o+='<br><strong><a href="'+a+'" target="_blank" id="wpstg-clone-url">'+this.stagingSiteUrl+"</a></strong>";case 15:"wpstg_push_processing"===this.action&&(o+='<a href="https://wp-staging.com/refresh-and-clear-cache/" target="_blank">How to delete the cache.</a>',(l=s.querySelector(".wpstg-clone-success-modal-text"))&&l.classList.add("wpstg--red")),"wpstg_cloning"===this.action&&(u=s.querySelector(".wpstg-rate-us"))&&u.classList.add("show"),s.innerHTML=s.innerHTML.replace("{text}",o),e.next=21;break;case 20:s.innerHTML=s.innerHTML.replace("{text}","");case 21:return e.abrupt("return",s);case 22:case"end":return e.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),s.openSuccessModal=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=null),this.stagingSiteUrl=n,this.showProcessLogs=t,this.initializeSuccessModal(e)},s.getModalType=function(){return this.modalType},s.renderProcessLogs=function(e,t){void 0===e&&(e="process");var n=c.getSwalContainer();if(0!==window.WPStaging.messages.length){var s=n.querySelector(".wpstg-"+this.modalType+"-"+e+"-logs");s.innerHTML="",window.WPStaging.messages.forEach((function(e){var t="wpstg--modal--process--msg--"+e.type.toLowerCase(),n=document.createElement("p");n.className=t,n.textContent="["+e.type+"] - ["+e.date+"] - "+e.message,s.appendChild(n)}))}var o=n.querySelector(".wpstg-"+this.modalType+"-"+e+"-logs"),r=t.target;t.preventDefault(),"none"===o.style.display||""===o.style.display?(o.style.display="block",r.textContent=wpstg.i18n.hideLogs,n.childNodes[0].style.width="97%",n.style.zIndex=9999):(o.style.display="none",r.textContent=wpstg.i18n.showLogs,n.childNodes[0].style.width="600px")},t}();function J(e){if(void 0!==e){e.useNewAdminAccount=k("#wpstg-new-admin-user"),e.adminEmail=S("#wpstg-new-admin-email"),e.adminPassword=S("#wpstg-new-admin-password"),e.databaseServer=S("#wpstg-db-server"),e.databaseUser=S("#wpstg-db-user"),e.databasePassword=S("#wpstg-db-pass"),e.databaseDatabase=S("#wpstg-db-database"),e.databasePrefix=S("#wpstg-db-prefix"),e.databaseSsl=k("#wpstg-db-ssl");var t=S("#wpstg_clone_dir");return e.cloneDir=encodeURIComponent(t.trim()),e.cloneHostname=S("#wpstg_clone_hostname"),e.cronDisabled=k("#wpstg_disable_cron"),e.emailsAllowed=k("#wpstg_allow_emails"),e.networkClone=k("#wpstg_network_clone"),e.uploadsSymlinked=k("#wpstg_symlink_upload"),e.cleanPluginsThemes=k("#wpstg-clean-plugins-themes"),e.cleanUploadsDir=k("#wpstg-clean-uploads"),e}}var K,Y=function(){function e(e){void 0===e&&(e=wpstg),this.wpstgObject=e,this.wpstgRefreshLicenseLink=document.querySelector("#wpstg-refresh-license-link"),this.wpstgRefreshLicenseLoader="#wpstg-refresh-license-loader",this.init(),this.addEvent()}var t=e.prototype;return t.addEvent=function(){var e=this;null!==this.wpstgRefreshLicenseLink&&this.wpstgRefreshLicenseLink.addEventListener("click",(function(){b(e.wpstgRefreshLicenseLoader),e.refreshLicenseStatus()}))},t.init=function(){this.notyf=new Notyf({duration:6e3,position:{x:"center",y:"bottom"},dismissible:!0,types:[{type:"warning",background:"orange",icon:!0}]})},t.refreshLicenseStatus=function(){var e=this;fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg-refresh-license-status",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(t){m(e.wpstgRefreshLicenseLoader),t.success?e.notyf.success("License refreshed successfully"):e.notyf.error("Please check your license key and try again")})).catch((function(t){e.notyf.error(t)}))},e}();!function(t){K={listen:function(){t("body").off("click",".wpstg--backup--remote-upload",K.clickedRemoteUpload).on("click",".wpstg--backup--remote-upload",K.clickedRemoteUpload)},clickedRemoteUpload:function(s){var o=this;return n(e().mark((function n(){var a,i,l,u,d,p;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=o,c.resetErrors(),s.preventDefault(),G.isCancelled=!1,G.modal.upload.data.file=a.getAttribute("data-filePath"),G.modal.upload.html&&G.modal.upload.confirmBtnTxt&&!document.getElementById("wpstg--modal--remote-upload")||(i=t("#wpstg--modal--remote-upload"),l=i.html(),u=i.attr("data-confirmButtonText"),G.modal.upload.html=l||null,G.modal.upload.confirmBtnTxt=u||null,i.remove()),e.next=8,c.getSwalModal(!1,{confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn"}).fire({title:"",html:G.modal.upload.html,focusConfirm:!1,confirmButtonText:G.modal.upload.confirmBtnTxt,showCancelButton:!0,preConfirm:function(){for(var e,t=c.getSwalContainer(),n=[],s=r(t.querySelectorAll('input[name="storages"]:checked'));!(e=s()).done;){var o=e.value;n.push(o.value)}return{file:G.modal.upload.data.file,isDeleteLocalBackup:null!==t.querySelector("#deleteLocalBackup:checked"),storages:n}},onRender:function(){var e=c.getSwalContainer(),t=Array.from(e.querySelectorAll('[type="checkbox"][name="storages"]:checked')).length>0;e.querySelector(".wpstg--swal2-confirm").disabled=!t}});case 8:if(d=e.sent,p=d.value){e.next=12;break}return e.abrupt("return");case 12:G.process({execute:function(){G.messages.reset(),K.prepareRemoteUpload(p)}});case 13:case"end":return e.stop()}}),n)})))()},prepareRemoteUpload:function(e){c.ajax({action:"wpstg--backups--prepare-remote-upload",accessToken:wpstg.accessToken,nonce:wpstg.nonce,wpstgRemoteUploadData:e},(function(e){e.success?(window.dispatchEvent(new Event("startedRemoteUploadingBackup")),G.timer.start(),K.remoteUploadBackup()):c.showAjaxFatalError(e.data,"","Submit an error report.")}),"json",!1,10,1.25,(function(e,t,n){423===e.status?(c.continueErrorHandle=!1,G.shouldCleanUp=!1,c.closeSwalModal(),setTimeout((function(){G.shouldCleanUp=!0}),1e3),c.showErrorModal(e.responseJSON.data)):c.continueErrorHandle=!0}))},remoteUploadBackup:function(){var s=0;c.resetErrors(),G.isCancelled?G.statusStop():c.ajax({action:"wpstg--backups--remote-upload",accessToken:wpstg.accessToken,nonce:wpstg.nonce},function(){var o=n(e().mark((function n(o){var r,a,i,c;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=0,!G.isCancelled){e.next=3;break}return e.abrupt("return");case 3:if(void 0!==o){e.next=6;break}return setTimeout((function(){K.remoteUploadBackup()}),wpstg.delayReq),e.abrupt("return");case 6:if(G.processResponse(o),G.processInfo.interval||G.statusStart("create"),!0!==o.isRunning){e.next=12;break}K.remoteUploadBackup(),e.next=30;break;case 12:if("JOB_FAIL"!==o.jobStatus){e.next=18;break}return e.next=15,G.checkMemoryExhaustion(o,"wpstg_remote_upload");case 15:setTimeout((function(){K.remoteUploadBackup()}),wpstg.delayReq),e.next=30;break;case 18:if(t("#wpstg--progress--status").text("Backup successfully uploaded!"),!G.messages.shouldWarn()){e.next=22;break}return G.logsModal(),e.abrupt("return");case 22:G.statusStop(),r=document.querySelector(".wpstg-backup-process-logs").innerHTML,i=(a='<div class="wpstg-backup-process-logs">'+r+"</div>").includes("wpstg--modal--process--msg--warning")||a.includes("wpstg--modal--process--msg--error")?"Issues(s) found!<br> ":"",G.downloadModal({title:"Backup Upload Complete",bodyText:""+i}),t(".wpstg-backup-success-logs-wrapper").show(),c=t(".wpstg-backup-success-logs"),G.messages.data.all.forEach((function(e){var t="wpstg--modal--process--msg--"+e.type.toLowerCase();c.append('<p class="'+t+'">['+e.type+"] - ["+e.date+"] - "+e.message+"</p>")}));case 30:case"end":return e.stop()}}),n)})));return function(e){return o.apply(this,arguments)}}(),"json",!1,0,1.25,(function(e,t,n){c.continueErrorHandle=!1,console.log(e);var o={messages:[]};++s<=10?K.remoteUploadBackup():(o.messages.push({type:"critical",message:"There was a PHP fatal error while processing the backup. You might need to check your PHP error log to find out the reason. Please contact WPSTAGING support if you need help."}),G.processResponse(o),G.cancel(),setTimeout(G.logsModal,500))}))}}}(jQuery);var V,X=K;!function(t){window.addEventListener("backups-tab",(function(){V.listen()})),V={listen:function(){t("body").off("click",".wpstg--backup--restore",V.clickedRestore).on("click",".wpstg--backup--restore",V.clickedRestore)},timer:{totalSeconds:0,interval:null,start:function(){if(null===V.timer.interval){V.timer.interval=setInterval((function(){var e;t(".wpstg--modal--process--elapsed-time").text((e=V.timer.totalSeconds,""+new Date(1e3*e).toISOString().substr(11,8))),V.timer.totalSeconds++}),1e3)}},stop:function(){V.timer.totalSeconds=0,V.timer.interval&&(clearInterval(V.timer.interval),V.timer.interval=null)}},clickedRestore:function(e){var t=this;WPStaging.checkUserDbPermissions("restore").then((function(){c.resetErrors(),e.preventDefault(),G.isCancelled=!1,G.modal.restore.data.file=t.getAttribute("data-filePath"),V.selectedBackup()}))},selectedBackup:function(){c.ajax({action:"wpstg--backups--read-backup-metadata",accessToken:wpstg.accessToken,nonce:wpstg.nonce,wpstg:{file:G.modal.restore.data.file}},(function(e){var n;try{var s=(n=JSON.parse(c.getDataFromWordPressResponse(e))).networks[Object.keys(n.networks)[0]];n=s.blogs[Object.keys(s.blogs)[0]]}catch(e){c.showError(e)}G.modal.restore.data.backupMetadata=n;var o=new FormData;o.append("action","wpstg--backups--restore--file-info"),o.append("accessToken",wpstg.accessToken),o.append("nonce",wpstg.nonce),o.append("filePath",G.modal.restore.data.file),fetch(ajaxurl,{method:"POST",body:o}).then(c.handleFetchErrors).then((function(e){return e.json()})).then((function(e){G.modal.restore.retryCount=0,V.importModal(e,o)})).catch((function(e){return c.showAjaxFatalError(e,"","Submit an error report.")})),t(".wpstg--modal--actions .wpstg--swal2-confirm").show(),t(".wpstg--modal--actions .wpstg--swal2-confirm").prop("disabled",!1)}))},importModal:function(s){var o=function s(o,r,a){void 0===r&&(r=!1),void 0===a&&(a=null),c.resetErrors(),G.isCancelled?G.statusStop():(G.timer.start(),window.addEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess),c.ajax({action:"wpstg--backups--restore",accessToken:wpstg.accessToken,nonce:wpstg.nonce,retry:r,errorCode:a},function(){var r=n(e().mark((function n(r){var a,i,l,u;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!G.isCancelled){e.next=2;break}return e.abrupt("return");case 2:if(c.retry.reset(),void 0!==r){e.next=6;break}return setTimeout((function(){s(o)}),wpstg.delayReq),e.abrupt("return");case 6:if(G.processResponse(r),G.processInfo.interval||G.statusStart("restore"),!0!==r.isRunning){e.next=12;break}s(o),e.next=29;break;case 12:if("JOB_FAIL"!==r.jobStatus){e.next=18;break}return e.next=15,G.checkMemoryExhaustion(r,"wpstg_restore");case 15:setTimeout((function(){s(o)}),wpstg.delayReq),e.next=29;break;case 18:if(window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess),t("#wpstg--progress--status").text("Backup successfully imported!"),!G.messages.shouldWarn()){e.next=23;break}return G.logsModal(),e.abrupt("return");case 23:G.statusStop(),a=t(".wpstg-backup-success-logs").innerHTML,l=(i='<div class="wpstg-backup-success-logs">'+a+"</div>").includes("wpstg--modal--process--msg--warning")||i.includes("wpstg--modal--process--msg--error")?"Issues(s) found!<br> ":"",u=G.modal.restore.data.backupMetadata.isExportingDatabase?"You will be redirected to the login page after closing this modal.":"",c.getSwalModal(!0,{container:"wpstg-restore-finished-container"}).fire({icon:"success",title:"Finished Successfully",html:'<div id="wpstg-restore-success" class="wpstg--grey">Site has been restored from backup. '+u+'  <br/><br/><span class="wpstg--modal--process--msg-found">'+l+'</span><button class="wpstg-backup-success-logs-button" data-txt-bad="">Show Logs</button></div><br/>'+i,onClose:function(){G.modal.restore.data.backupMetadata.isExportingDatabase?(document.getElementById("wpstg-restore-wait").style.display="flex",setTimeout((function(){document.location.reload(!0)}),15e3),c.ajax({action:"raw_wpstg--backups--login-url",accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){if(void 0!==e.data.loginUrl||"private_site"!==e.data.code){var t=new URL(e.data.loginUrl);t.searchParams.set("accessToken",wpstg.accessToken),t.searchParams.set("wpstgAfterRestore","yes"),G.modal.restore.data.backupMetadata.isCreatedOnWordPressCom&&t.searchParams.set("wpstgIsBackupCreatedOnWordPressCom","yes"),window.location.href=t.toString()}}))):G.fetchListing()}});case 29:case"end":return e.stop()}}),n)})));return function(e){return r.apply(this,arguments)}}(),"json",!1,10,1.25,function(){var t=n(e().mark((function t(r,a,i){var l,u;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return l=parseInt(r.status),t.next=3,G.checkMemoryExhaustion({messages:[]},"wpstg_restore");case 3:if(c.retry.retryOnErrors.includes(l)){t.next=5;break}return t.abrupt("return");case 5:if(c.retry.canRetry()){t.next=7;break}return t.abrupt("return");case 7:c.continueErrorHandle=!1,c.retry.incrementRetry(),u=c.retry.currentDelay,setTimeout(n(e().mark((function t(){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s(o,!0,l);case 1:case"end":return e.stop()}}),t)}))),u);case 11:case"end":return t.stop()}}),t)})));return function(e,n,s){return t.apply(this,arguments)}}()))},r=t("#wpstg--modal--backup--restore");G.modal.restore.html=r.html(),G.modal.restore.baseDirectory=r.attr("data-baseDirectory"),G.modal.restore.btnTxtNext=r.attr("data-nextButtonText"),G.modal.restore.btnTxtConfirm=r.attr("data-confirmButtonText"),G.modal.restore.btnTxtCancel=r.attr("data-cancelButtonText"),c.getSwalModal().mixin({progressSteps:["1","2"]}).queue([{html:t(".wpstg--modal--backup--restore--introduction").first(),confirmButtonText:"Next",showCancelButton:!0,showConfirmButton:!0,reverseButtons:!0,width:600,onRender:function(){t(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-database").hide(),t(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-database-multisite").hide(),t(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-files").hide(),G.modal.restore.data.backupMetadata.isExportingDatabase&&t(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-database").show(),G.modal.restore.data.backupMetadata.isExportingDatabase&&"multi"===G.modal.restore.data.backupMetadata.singleOrMulti&&t(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-database-multisite").show(),(G.modal.restore.data.backupMetadata.isExportingMuPlugins||G.modal.restore.data.backupMetadata.isExportingPlugins||G.modal.restore.data.backupMetadata.isExportingThemes||G.modal.restore.data.backupMetadata.isExportingUploads||G.modal.restore.data.backupMetadata.isExportingOtherWpContentFiles)&&t(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-files").show()}},{html:s,confirmButtonText:"Restore",showCancelButton:!0,showConfirmButton:!0,reverseButtons:!0,width:650}]).then((function(e){if(e&&e.value&&e.value[1]&&!0===e.value[1]){G.isCancelled=!1;var t=G.modal.restore.data;G.modal.restore.data.fileObject=null,t.file=G.modal.restore.baseDirectory+t.file,c.ajax({action:"wpstg--backups--prepare-restore",accessToken:wpstg.accessToken,nonce:wpstg.nonce,wpstgRestoreData:t},(function(e){e.success?G.process({execute:function(){G.messages.reset(),o(t)}}):c.showAjaxFatalError(e.data,"","Submit an error report.")}),"json",!1,10,1.25,(function(e,t,n){423===e.status?(c.continueErrorHandle=!1,G.shouldCleanUp=!1,c.closeSwalModal(),setTimeout((function(){G.shouldCleanUp=!0}),1e3),c.showErrorModal(e.responseJSON.data)):c.continueErrorHandle=!0}))}}))}}}(jQuery);var $,Z=V;!function(t){window.addEventListener("backupListingFinished",(function(){window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)})),$={listen:function(){t("body").off("click","#wpstg-show-cloud-backup",$.listCloudBackups).on("click","#wpstg-show-cloud-backup",$.listCloudBackups).off("click",".wpstg--cloud--backup--restore",$.clickedCloudRestore).on("click",".wpstg--cloud--backup--restore",$.clickedCloudRestore).off("click",".wpstg--cloud--backup--download",$.clickedCloudRestoreDownload).on("click",".wpstg--cloud--backup--download",$.clickedCloudRestoreDownload),t("#wpstg--tab--backup").off("click",".wpstg-delete-cloud-backup",$.deleteCloudFile).on("click",".wpstg-delete-cloud-backup",$.deleteCloudFile)},cancelDownload:function(e,t){void 0===e&&(e={}),void 0===t&&(t=null),G.timer.stop(),clearInterval(G.processInfo.interval),G.isCancelled=!0,G.processInfo.interval=null,c.closeSwalModal(),c.getSwalModal(!0).fire({title:"Cancelling & Cleaning up",text:"This modal will close automatically when done...",icon:"info",showConfirmButton:!1,showCloseButton:!1,showLoaderOnConfirm:!1,showCancelButton:!1,allowEscapeKey:!1,allowOutsideClick:!1,width:650,onRender:function(){$.sendCancelDownloadRequest(Object.assign({isInit:"yes"},e),t)}})},percentage:0,sendCancelDownloadRequest:function(e,t){G.performingCancelRequest||(G.performingCancelRequest=!0,c.ajax(Object.assign({action:"wpstg--download--cancel",accessToken:wpstg.accessToken,nonce:wpstg.nonce,jobIdBeingCancelled:c.getJobId()},e),(function(n){G.performingCancelRequest=!1,G.isCancelled=!0,c.showAjaxFatalError(n,"","Submit an error report."),n.hasOwnProperty("jobStatus")||c.showErrorModal("Cancel process did not finish gracefully. Some temporary files might not have been cleaned up."),!0===n.jobStatus?(c.closeSwalModal(),null!=t&&t(),document.location.reload(!0)):(e.isInit="no",$.sendCancelDownloadRequest(e,t))}),"json",!1,10,1.25,(function(n,s,o){G.performingCancelRequest=!1,c.continueErrorHandle=!1,423!==n.status?(c.closeSwalModal(),c.showErrorModal("Cancel process did not finish gracefully. Some temporary files might not have been cleaned up."),null!=t&&t()):setTimeout((function(){$.sendCancelDownloadRequest(e,t)}),1e3)})))},clickedCloudRestore:function(e){e.preventDefault(),G.isCancelled=!1,G.modal.restore.data.file=this.getAttribute("data-id"),G.modal.restore.data.storageProviderName=this.getAttribute("data-storageProviderName"),G.modal.restore.data.size=this.getAttribute("data-size"),G.modal.restore.data.name=this.getAttribute("data-name"),G.modal.restore.data.isInit="yes",$.setupDownloadModal(),$.downloadCloudBackup().then((function(e){var t=e.messages;t&&t.length>1&&(delete t[1],e.messages=t),c.closeSwalModal(),G.modal.restore.data.file=G.modal.restore.data.name,Z.selectedBackup(),Z.timer.stop()}))},deleteCloudFile:function(e){var n=this;e.preventDefault(),c.resetErrors();c.getSwalModal(!1,{confirmButton:"wpstg--btn--confirm wpstg-btn-danger wpstg-link-btn"}).fire({showConfirmButton:!0,showCancelButton:!0,cancelButtonText:"Cancel",confirmButtonText:"Delete",icon:"warning",title:"Delete Remote Backup?",html:'<div class="wpstg--modal--delete">Do you want to delete this backup file from the remote storage server?</div>'}).then((function(e){if(e.value){c.isLoading(!0);var s=n.getAttribute("data-file"),o=n.getAttribute("data-storageProviderName"),r=n.getAttribute("data-id");c.ajax({action:"wpstg--backups--cloud--delete",accessToken:wpstg.accessToken,nonce:wpstg.nonce,file:s,storageProviderName:o},(function(e){if(c.showAjaxFatalError(e,""," Please submit an error report and contact us."),c.isLoading(!1),!0===e){c.getSwalModal(!0).fire({title:"Backup Deleted!",text:"Backup has been deleted from remote storage.",icon:"success",showConfirmButton:!1,showCloseButton:!0,showLoaderOnConfirm:!1,showCancelButton:!1,allowEscapeKey:!1,allowOutsideClick:!0,width:650});var n=document.querySelector('li[id="'+r+'"]');if(n){n.remove();var s=document.querySelectorAll("li.wpstg-cloud-backup-item");0===Object.keys(s).length&&t(".wpstg-cloud-backup-empty-message").show()}}else c.getSwalModal(!0).fire({title:"Failed",text:"Failed to delete the backup",icon:"error",showConfirmButton:!1,showCloseButton:!0,showLoaderOnConfirm:!1,showCancelButton:!1,allowEscapeKey:!1,allowOutsideClick:!0,width:650})}))}}))},listCloudBackups:function(s){return n(e().mark((function n(){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:y(),s.preventDefault(),t("#wpstg-cloud-backup-list-ul").show(),t("#wpstg-show-cloud-backup").text("Refresh Remote Backups"),c.resetErrors(),c.isLoading(!0),fetch(ajaxurl+"?action=wpstg--storage--list&_="+Math.random(),{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg--storage--list",accessToken:wpstg.accessToken,nonce:wpstg.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(c.handleFetchErrors).then((function(e){return e.json()})).then((function(e){if(G.isEmpty=!0,G.providersCount=0,e.length>0)for(var n=!1,s=e.length,o=0;o<e.length;o++){var r=e[o];fetch(ajaxurl+"?action=wpstg--backups--cloud--file-list&_="+Math.random()+"&withTemplate=true&storageProviderName="+r,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg--backups--cloud--file-list",accessToken:wpstg.accessToken,nonce:wpstg.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(c.handleFetchErrors).then((function(e){return e.json()})).then((function(e){if(!1===(null==e?void 0:e.success))return Promise.reject(e.data);G.providersCount++;var o=t("#wpstg-cloud-backup-list-ul");n||(o.empty(),n=!0),o.append(e,o),e.length>0&&(G.isEmpty=!1),t("#cloud-backup-title").show(),t("#wpstg-existing-cloud-backups").show(),G.providersCount===s&&!0===G.isEmpty&&(c.isLoading(!1),t(".wpstg-cloud-backup-empty-message").show()),G.providersCount===s&&!1===G.isEmpty&&(c.isLoading(!1),t(".wpstg-cloud-backup-empty-message").hide());var r=document.querySelectorAll("li.wpstg-cloud-backup-item"),a=Array.from(r);a.sort((function(e,t){var n=new Date(e.querySelector("strong").nextSibling.textContent.trim());return new Date(t.querySelector("strong").nextSibling.textContent.trim())-n}));var i=document.querySelector("ul#wpstg-cloud-backup-list-ul");a.forEach((function(e){return i.appendChild(e)})),E()})).catch((function(e){c.showAjaxFatalError(!1,e,"Please submit an error report and contact us.")}))}T()})).catch((function(e){c.showAjaxFatalError(e,"","Please submit an error report and contact us.")})),T();case 8:case"end":return e.stop()}}),n)})))()},hideListing:function(){t("#wpstg-show-cloud-backup").show(),t("#cloud-backup-title").hide(),t("#wpstg-existing-cloud-backups").hide()},clickedCloudRestoreDownload:function(e){e.preventDefault(),G.isCancelled=!1,G.modal.restore.data.file=this.getAttribute("data-id"),G.modal.restore.data.storageProviderName=this.getAttribute("data-storageProviderName"),G.modal.restore.data.size=this.getAttribute("data-size"),G.modal.restore.data.name=this.getAttribute("data-name"),G.modal.restore.data.isInit="yes",$.setupDownloadModal(),$.downloadCloudBackup().then((function(e){var n;if(e.messages&&e.messages.length>=2&&e.messages[1].md5BaseName&&e.messages[1].downloadUrl&&e.messages[1].dataName&&(e.messages[1].md5BaseName,n=e.messages[1].downloadUrl,e.messages[1].dataName),null===G.modal.download.html){var s=t("#wpstg-backup-success-modal");G.modal.download.html=s.html()}var o='<div>You can optionally download the backup to your local device:</div><div class="output"><div class="download-action-buttons"><a href ="'+n+'" class="wpstg-button wpstg-blue-primary wpstg-download-to-computer">Download to my computer</a></div></div>';c.getSwalModal(!0).fire({html:G.modal.download.html.replace("{title}","Backup Successfully Downloaded to this Website").replace("{btnTxtLog}",wpstg.i18n.showLogs).replace("{text}",o),showConfirmButton:!1,showCloseButton:!0,showLoaderOnConfirm:!1,showCancelButton:!1,allowEscapeKey:!1,allowOutsideClick:!1,icon:"success",onRender:function(){t(".wpstg-backup-success-logs-wrapper").show(),t("body").off("click",".wpstg-backup-success-logs-button").on("click",".wpstg-backup-success-logs-button",(function(e){G.showLogsInModal(e,"success")})),t(".wpstg-download-to-computer").on("click",(function(){setTimeout((function(){c.closeSwalModal()}),1500)}))}})}))},setupDownloadModal:function(){c.resetErrors(),c.getSwalModal(!0,{content:"wpstg--process--content"}).fire({title:null,html:'<div class="modal"><div class="center"><span class="wpstg-loader"></span><h3 class="wpstg--status--title">Downloading backup from remote</h3></div><div class="output"><div class="wpstg--modal--process--subtitle"> Progress <span class="wpstg--modal--process--percent">0</span>% - Elapsed time <span class="wpstg--modal--process--elapsed-time">0:00</span></div></div></div><div class="wpstg--modal--process--generic-problem"></div><button class="wpstg-backup-process-logs-button" data-txt-bad="(%) Critical, (%) Errors, (%) Warnings. Show Logs"><span style="text-decoration: underline">'+wpstg.i18n.showLogs+'</span></button><div class="wpstg-backup-process-logs"></div>',showConfirmButton:!1,showCloseButton:!1,showLoaderOnConfirm:!1,showCancelButton:!0,allowEscapeKey:!1,allowOutsideClick:!1,width:650,onRender:function(){var e=c.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",(function(e){confirm("Do you want to cancel the process?")&&($.cancelDownload(),window.dispatchEvent(new Event("backupListingFinished")))}))}}),G.messages.reset(),t("body").off("click",".wpstg-backup-process-logs-button").on("click",".wpstg-backup-process-logs-button",(function(e){G.showLogsInModal(e)})),Z.timer.stop(),Z.timer.start()},downloadCloudBackup:function(){return window.addEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess),new Promise((function(e){G.isCancelled||c.ajax({action:"wpstg--backups--download--cloud-backup",accessToken:wpstg.accessToken,nonce:wpstg.nonce,file:G.modal.restore.data.file,storageProviderName:G.modal.restore.data.storageProviderName,cloudFileName:G.modal.restore.data.name,size:G.modal.restore.data.size,isInit:G.modal.restore.data.isInit},(function(n){G.addResponseMessagesToLog(n),!0===n.jobStatus?(c.closeSwalModal(),window.dispatchEvent(new Event("backupListingFinished")),e(n),window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):(G.messages.shouldWarn()&&G.logsModal(),t(".wpstg--status--title").text(n.statusTitle),t(".wpstg--modal--process--percent").text(n.percentage),c.setJobId(n.jobId),G.modal.restore.data.isInit="no",e($.downloadCloudBackup()))}))}))}}}(jQuery);var ee=$,te=function(e){var t={isCancelled:!1,isFinished:!1,getLogs:!1,tableSelector:null,fileSelector:null,directoryNavigator:null,notyf:null};t.wpstgProcessModal=new Q;var n={elements:[],get:function(t){return-1!==e.inArray(t,n.elements)||(n.elements[t]=jQuery(t)),n.elements[t]},refresh:function(e){e.elements[e]=jQuery(e)}},s=function(){WPStaging.ajax({action:"wpstg_cancel_push_processing",accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){if(e.success)return t.isCancelled=!0,n.get(".wpstg-loader").hide(),n.get("#wpstg-cancel-pushing").hide(),window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess),void WPStaging.loadOverview()}),"json",!1)},o=function e(){var o=n.get("#wpstg-push-changes").data("clone"),c=n.get("#wpstg-delete-upload-before-pushing")[0].checked,u=!1;c&&(u=n.get("#wpstg-backup-upload-before-pushing")[0].checked);var w=a(),f=i(),m=!1;t.isCancelled=!1,w.length>f.length?w="":f.length>w.length&&(f="",m=""===w),WPStaging.ajax({action:"wpstg_push_processing",accessToken:wpstg.accessToken,nonce:wpstg.nonce,clone:o,includedTables:w,excludedTables:f,allTablesExcluded:m,selectedTablesWithoutPrefix:l(),includedDirectories:d(),excludedDirectories:p(),extraDirectories:g(),createBackupBeforePushing:n.get("#wpstg-create-backup-before-pushing")[0].checked,deletePluginsAndThemes:n.get("#wpstg-remove-uninstalled-plugins-themes")[0].checked,deleteUploadsBeforePushing:c,backupUploadsBeforePushing:u},(function(o){return t.isCancelled?(s(),n.get(".wpstg-loader").hide(),n.get("#wpstg-cancel-pushing").hide(),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):!1===o?(showError("Something went wrong! Error: No response.  Go to WP Staging > Settings and lower 'File Copy Limit' and 'DB Query Limit'. Also set 'CPU Load Priority to low 'and try again. If that does not help, <a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "),n.get(".wpstg-loader").hide(),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):void 0!==o.error&&o.error?(WPStaging.showError("Something went wrong! Error: "+o.message+".  Go to WP Staging > Settings and lower 'File Copy Limit' and 'DB Query Limit'. Also set 'CPU Load Priority to low 'and try again. If that does not help, <a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):(void 0!==o.last_msg&&o.last_msg&&"function"==typeof WPStaging.getLogs&&WPStaging.getLogs(o.last_msg),void(!1===o.status?(h(o),setTimeout((function(){n.get(".wpstg-loader").show(),e()}),wpstg.delayReq)):!0===o.status?(h(o),e()):("finished"===o.status||void 0!==o.job_done&&o.job_done)&&(window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess),r(o))))}),"json",!1)},r=function(e){h(e),n.get(".wpstg-loader").hide(),n.get(".wpstg-prev-step-link").attr("disabled",!1),n.get("#wpstg-cancel-pushing").hide(),null!==wpstg.i18n.wpstg_push_processing&&t.wpstgProcessModal.openSuccessModal(wpstg.i18n.wpstg_push_processing,!0)},a=function(){return null===t.tableSelector?"":t.tableSelector.getIncludedTables()},i=function(){return null===t.tableSelector?"":t.tableSelector.getExcludedTables()},l=function(){return null===t.tableSelector?"":t.tableSelector.getSelectedTablesWithoutPrefix()},u=function(e,t,n,s){return c.getSwalModal(!1,{container:"wpstg-swal-push-container",confirmButton:s+" wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn"}).fire({title:e,icon:"warning",html:t,width:"750px",focusConfirm:!1,confirmButtonText:n,showCancelButton:!0})},d=function(){var t=[];return e(".wpstg-dir input:checked").each((function(){var n=e(this);n.parent(".wpstg-dir").parents(".wpstg-dir").children(".wpstg-expand-dirs").hasClass("disabled")||t.push(n.val())})),t},p=function(){var t=[];return e(".wpstg-dir input:not(:checked)").each((function(){var n=e(this);t.push(n.val())})),t},g=function(){var t=[];return e("#wpstg_extraDirectories").val()?t=e("#wpstg_extraDirectories").val().split(/\r?\n/):t},h=function(e,o){if(void 0===e.percentage)return!1;null!==e&&(void 0===WPStaging.data&&(WPStaging.data={action:"wpstg_push_processing"}),WPStaging.data.action="wpstg_push_processing",WPStaging.data.cloneID=n.get("#wpstg-push-changes").data("clone"),t.wpstgProcessModal.openProcessModal(WPStaging.data,e,!0),new Proxy(t.wpstgProcessModal,{set:function(e,n,o){return"isCancelled"===n&&!0===o&&(t.isCancelled=!0,s()),e[n]=o,!0}}).isCancelled=t.wpstgProcessModal.isProcessCancelled)};return t.init=function(){var s;n.get("#wpstg-workflow").on("click","#wpstg-push-changes",(function(e){e.preventDefault(),n.get(".wpstg-tabs-wrapper").hide(),n.get("#wpstg-push-changes").hide(),n.get(".wpstg-prev-step-link").hide(),n.get("#wpstg-push-changes-details").hide();var t=n.get("#wpstg-push-changes").data("clone-name");u("Do you want to push the staging site?","<p class='wpstg-push-confirmation-message'>This will overwrite the production/live site and its plugins, themes and media assets with data from the staging site: \""+t+'".  <br/><br/>Database data will be overwritten for each selected table. Take care if you use a shop system like WooCommerce and read the <a href="https://wp-staging.com/docs/skip-woocommerce-orders-and-products/" target="_blank">FAQ</a>. <br/><br/><b>Important:</b> Before you proceed make sure that you have a full site backup. If the pushing process is not successful contact us at <a href=\'mailto:support@wp-staging.com\'>support@wp-staging.com</a> or use the Contact Us button.</p>',"Push","wpstg-confirm-push").then((function(e){if(e.value)return n.get("#wpstg-push-changes").attr("disabled",!0),n.get(".wpstg-prev-step-link").attr("disabled",!0),n.get("#wpstg-scanning-files").hide(),n.get(".wpstg-progress-bar-wrapper").hide(),n.get("#wpstg-cancel-pushing").hide(),WPStaging.switchStep(3),window.addEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess),void o();n.get(".wpstg-tabs-wrapper").show(),n.get("#wpstg-push-changes").show(),n.get(".wpstg-prev-step-link").show()}))})),(s=n.get("#wpstg-workflow")).on("click",".wpstg-push-changes",(function(o){var r=this;WPStaging.checkUserDbPermissions("push").then((function(a){if(o.preventDefault(),e(r).attr("disabled"))return!1;s.addClass("loading");var i=e(r).data("clone");t.data={action:"wpstg_scan",clone:i,accessToken:wpstg.accessToken,nonce:wpstg.nonce},WPStaging.ajax(t.data,(function(e){e.length<1&&showError("Something went wrong! No response.  Go to WP Staging > Settings and lower 'File Copy Limit' and 'DB Query Limit'. Also set 'CPU Load Priority to low 'and try again. If that does not help, <a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "),s.removeClass("loading").html(e),WPStaging.switchStep(2),n.get(".wpstg-step3-cloning").hide(),n.get(".wpstg-step3-pushing").show(),n.get(".wpstg-loader").hide(),t.directoryNavigator=new O("#wpstg-scanning-files",wpstg,t.notyf),t.directoryNavigator.countSelectedFiles(),t.tableSelector=new P,t.fileSelector=new j,t.tableSelector.countSelectedTables(),t.fileSelector.countSelectedFiles()}),"HTML")}))})).on("click",".wpstg-prev-step-link",(function(e){e.preventDefault(),WPStaging.loadOverview()})).on("click","#wpstg-use-target-dir",(function(t){t.preventDefault(),e("#wpstg_clone_dir").val(this.getAttribute("data-path"))})).on("click","#wpstg-use-target-hostname",(function(t){t.preventDefault(),e("#wpstg_clone_hostname").val(this.getAttribute("data-uri"))})).on("change","#wpstg-delete-upload-before-pushing",(function(t){t.currentTarget.checked?e("#wpstg-backup-upload-container").show():(e("#wpstg-backup-upload-container").hide(),e("#wpstg-backup-upload-before-pushing").removeAttr("checked"))})),function(){var e=n.get("#wpstg-workflow");e.on("click","#wpstg-db-connect",(function(e){e.preventDefault(),n.get(".wpstg-loader").show(),n.get("#wpstg-db-status").hide(),WPStaging.ajax({action:"wpstg_database_connect",accessToken:wpstg.accessToken,nonce:wpstg.nonce,databaseUser:n.get("#wpstg-db-user").val(),databasePassword:n.get("#wpstg-db-pass").val(),databaseServer:n.get("#wpstg-db-server").val(),databaseDatabase:n.get("#wpstg-db-database").val(),databasePrefix:n.get("#wpstg-db-prefix").val(),databaseSsl:n.get("#wpstg-db-ssl").is(":checked")},(function(e){if(!1===e)return showError("Something went wrong! Error: No response.Please try again. If that does not help, <a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "),n.get(".wpstg-loader").hide(),n.get("#wpstg-db-status").remove(),n.get("#wpstg-error-details").hide(),void n.get("#wpstg-db-connect").after('<span id="wpstg-db-status" class="wpstg-failed"> Failed</span>');if(void 0!==e.success&&e.success)return n.get(".wpstg-loader").hide(),n.get("#wpstg-db-status").hide(),n.get("#wpstg-error-details").hide(),n.get("#wpstg-db-error").hide(),void v("success","Database connection successful");var t="Failed response";void 0!==e.data&&void 0!==e.data.message&&e.data.message&&(t=e.data.message),WPStaging.showError("Something went wrong! Error: "+t+" Please try again. If it still fails, <a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "),n.get(".wpstg-loader").hide(),n.get("#wpstg-db-status").hide(),n.get("#wpstg-db-error").remove(),v("error","Error: "+t)}),"json",!1)})),e.on("click","#wpstg-ext-db",(function(){this.checked?(n.get("#wpstg-db-server").removeAttr("readonly"),n.get("#wpstg-db-user").removeAttr("readonly"),n.get("#wpstg-db-pass").removeAttr("readonly"),n.get("#wpstg-db-database").removeAttr("readonly"),n.get("#wpstg-db-prefix").removeAttr("readonly"),n.get("#wpstg-db-ssl").removeAttr("readonly")):(n.get("#wpstg-db-server").attr("readonly",!0).val(""),n.get("#wpstg-db-user").attr("readonly",!0).val(""),n.get("#wpstg-db-pass").attr("readonly",!0).val(""),n.get("#wpstg-db-database").attr("readonly",!0).val(""),n.get("#wpstg-db-prefix").attr("readonly",!0).val(""),n.get("#wpstg-db-ssl").attr("readonly",!0).prop("checked",!1))}))}(),function(){var s=n.get("#wpstg-workflow");s.on("click",".wpstg-edit-clone-data",(function(n){if(n.preventDefault(),t.wpstgCloneEdit=new L,e(this).attr("disabled"))return!1;var o=e(this).data("clone");t.data={action:"wpstg_edit_clone_data",clone:o,accessToken:wpstg.accessToken,nonce:wpstg.nonce},WPStaging.ajax(t.data,(function(e){s.html(e)}),"HTML")})).on("click",".wpstg-prev-step-link",(function(e){e.preventDefault(),WPStaging.loadOverview()})).on("click","#wpstg-save-clone-data",(function(e){e.preventDefault();var s="#wpstg-edit-clone-data-",o=n.get(s+"clone-id").val(),r=c.sanitizeEventAttribute(n.get(s+"clone-name").val()),a=c.sanitizeEventAttribute(n.get(s+"directory-name").val()),i=n.get(s+"path").val(),l=n.get(s+"url").val(),u=c.sanitizeEventAttribute(n.get(s+"prefix").val()),d=c.sanitizeEventAttribute(n.get(s+"database-user").val()),p=n.get(s+"database-password").val(),g=c.sanitizeEventAttribute(n.get(s+"database-database").val()),h=c.sanitizeEventAttribute(n.get(s+"database-server").val()),w=c.sanitizeEventAttribute(n.get(s+"database-prefix").val()),f=n.get(s+"database-ssl").is(":checked");t.data={action:"wpstg_save_clone_data",clone:o,cloneName:r,directoryName:a,path:i,url:l,prefix:u,externalDBUser:d,externalDBPassword:p,externalDBDatabase:g,externalDBHost:h,externalDBPrefix:w,externalDBSsl:f,accessToken:wpstg.accessToken,nonce:wpstg.nonce},Promise.any([new Promise((function(e){return t.wpstgCloneEdit.checkDatabase(e)}))]).then((function(){t.wpstgCloneEdit.isDbConnected?WPStaging.ajax(t.data,(function(e){"Success"===e?(WPStaging.loadOverview(),v("success","Clone data saved successfully")):alert(e)}),"HTML"):v("error","Could not save clone data <br/> Error: "+wpstg.i18n.dbConnectionFailed)})).catch((function(e){console.error("Error:",e),v("error","Error:"+e)}))}))}(),new L,new A,new M,new I,z.listen(),X.listen(),ee.listen(),new Q,new Y},t}(jQuery);jQuery(document).ready((function(e){te.init(),window.wpstgPro={getAdvancedCloningOptions:J,saveGeneratedLinkData:M.saveGeneratedLinkData},jQuery(document).on("click","#wpstg-update-mail-settings",(function(t){t.preventDefault(),e("#wpstg-update-mail-settings").attr("disabled","disabled");var n={action:"wpstg_update_staging_mail_settings",emailsAllowed:e("#wpstg_allow_emails").is(":checked"),accessToken:wpstg.accessToken,nonce:wpstg.nonce};jQuery.ajax({url:ajaxurl,type:"POST",data:n,error:function(e,t,n){c.getSwalModal().fire("Unknown error","Please get in contact with us to solve it support@wp-staging.com","error")},success:function(t){var n="error";return t.success&&(n="success"),c.getSwalModal().fire("",t.message,n).then((function(){jQuery(".wpstg-mails-notice").slideUp("fast")})),e("#wpstg-update-mail-settings").removeAttr("disabled"),!0},statusCode:{404:function(){c.getSwalModal().fire("404","Something went wrong; can't find ajax request URL! Please get in contact with us to solve it support@wp-staging.com","error")},500:function(){c.getSwalModal().fire("500","Something went wrong; internal server error while processing the request! Please get in contact with us to solve it support@wp-staging.com","error")}}})}))}))}();
