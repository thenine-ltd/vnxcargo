!function(l,e,c){"use strict";var r=l.TMEPOADMINSETTINGSJS,m=c.epoAPI.util.getStorage("localStorage"),o=l.confirm,a=l.toastr,s=0;function i(e){var t=c("#tm_epo_consent_for_transmit");t.length&&t.is(":checked")&&0===s?(s=1,c(".tm-license-result").html('<div class="activated"><p>'+r.i18n_sending_data+"</p></div>"),c(".tm-license-button").block({message:null}),t={action:"tm_"+e+"_license",username:c("#tm_epo_envato_username").val(),key:c("#tm_epo_envato_purchasecode").val(),security:r.settings_nonce},c.post(r.ajax_url,t,function(t){t=t&&-1!==t?t&&t.message&&t.result&&("-3"===t.result||"-2"===t.result||"wp_error"===t.result||"server_error"===t.result)||t&&t.message&&t.result&&"4"===t.result?t.message:"":r.i18n_invalid_request;c(".tm-license-result").html(t),c(".tm-license-button").unblock()},"json").always(function(t){c(".tm-license-button").unblock(),s=0,t&&t.result&&"4"===t.result&&("activate"===e&&(c(".tm-deactivate-license").removeClass("tm-hidden"),c(".tm-activate-license").removeClass("tm-hidden").addClass("tm-hidden")),"deactivate"===e&&(c(".tm-deactivate-license").removeClass("tm-hidden").addClass("tm-hidden"),c(".tm-activate-license").removeClass("tm-hidden")))})):c(".tm-license-result").html('<div class="error"><p>'+r.i18n_must_concent+"</p></div>")}function _(t){var t=t.val(),e=c("#tm_epo_options_placement_custom_hook").closest("tr");"custom"===t?e.show():e.hide()}function d(t){var t=t.val(),e=c("#tm_epo_totals_box_placement_custom_hook").closest("tr");"custom"===t?e.show():e.hide()}function p(t){var t=t.val(),e=c("#tm_epo_options_placement").closest("tr"),s=c("#tm_epo_totals_box_placement").closest("tr"),a=c("#tm_epo_options_placement_custom_hook").closest("tr"),n=c("#tm_epo_totals_box_placement_custom_hook").closest("tr");"action"===t?(e.hide(),s.hide(),a.hide(),n.hide()):(e.show(),s.show(),_(c("#tm_epo_options_placement")),d(c("#tm_epo_totals_box_placement")))}function u(t){var t=t.val(),e=c("#tm_epo_floating_totals_box_visibility").closest("tr"),s=c("#tm_epo_floating_totals_box_add_button").closest("tr"),a=c("#tm_epo_floating_totals_box_pixels").closest("tr");"disable"===t?(e.hide(),s.hide(),a.hide()):(e.show(),s.show(),f(c("#tm_epo_floating_totals_box_visibility")))}function f(t){var t=t.val(),e=c("#tm_epo_floating_totals_box").val(),s=c("#tm_epo_floating_totals_box_pixels").closest("tr");"always"===t||"disable"===e?s.hide():s.show()}function h(t){var t=t.is(":checked"),e=c("#tm_epo_show_price_inside_option_hidden_even").closest("tr"),s=c("#tm_epo_multiply_price_inside_option").closest("tr");t?(e.show(),s.show()):(e.hide(),s.hide())}function v(t){var t=t.is(":checked"),e=c("#tm_epo_show_upload_image_replacement").closest("tr");t?e.hide():e.show()}function b(t){t=t.val();c(".tm-epo-field-label").find(".tc-epo-style-wrapper, .tm-epo-style").removeClass("square square2 round round2").addClass(t)}function g(t){var e=c("#tm_epo_css_styles_style").closest("tr");t.is(":checked")?e.show():e.hide()}function w(t){t=t.val();c(".tm-border-type").removeClass("square round shadow thinline").addClass(t)}function n(t){return t.closest("tr")}function x(t,e,s,a){n(s).addClass("tm-hidden"),n(s.filter("."+t)).removeClass("tm-hidden"),a.find(".tm-section-desc .tm-section-menu-item").removeClass("active"),e.addClass("active")}function y(t,e,s){t.block({message:null}),c.post(r.ajax_url,e,function(t){t&&(1===t.error?a.error(t.message,r.i18n_epo):(a.success(t.message,r.i18n_epo),s&&l.location.reload()))},"json").always(function(){t.unblock()})}c(function(){var a,n,t=c(".tm-settings-wrap");0<t.length&&((t=t.find(":checkbox")).closest("label").addClass("tm-epo-switch-wrapper-label"),t.wrap('<span class="tm-epo-switch-wrapper tc"></span>'),t.after('<span class="tc-label tm-epo-switch tc"></span>'),c(".forminp .description").toArray().forEach(function(t){t=c(t);t.closest("tr").find(".titledesc").append(t)}),c("#tm_epo_consent_for_transmit").closest("tr").after(c('<tr valign="top"><th scope="row" class="titledesc tm-license-div"></th><td class="forminp forminp-license"></td></tr>')),c(".tm-license-div").append(c(".tm-license-button")),c(".forminp-license").append(c(".tm-license-result")),c(l).on("tc-opentab.tmtabs tc-isopentab.tmtabs",function(t,e){var s,a,n,o=e.table.find(".tm-section-desc .tm-section-menu-item");0<o.length&&(m&&(s=m.getItem("tmadminextratab")),a=o.filter('[data-menu="'+s+'"]'),n=e.table.find("select,input,text,textarea"),x(s=s&&0!==a.length?s:(a=c(o).eq(0)).attr("data-menu"),a,n,e.table))}),c(e).on("keydown.tmtabs",".tm-section-menu-item",function(t){var e,s=c(this);13===t.keyCode&&s.trigger("click"),39===t.keyCode&&(e=s.next(".tm-section-menu-item")),(e=37===t.keyCode?s.prev(".tm-section-menu-item"):e)&&e.length&&(s.trigger("blur"),e.trigger(" focus").trigger("click"),t.preventDefault())}),c(e).on("click",".tm-section-menu-item",function(){var t=c(this),e=t.attr("data-menu"),s=t.closest(".tm-tab");x(e,t,s.find("select,input,text,textarea"),s),m&&m.setItem("tmadminextratab",e)}),c(l).on("tc-tmtabs-clicked",function(t,e){var s,a,n,o,i,l=e.table.find(".tm-section-desc .tm-section-menu-item");0<l.length&&(m&&(s=m.getItem("tmadminextratab")),m&&(a=m.getItem("tmadminextratab-context")),n=e.header.attr(e.options.dataattribute),i=e.table.find("select,input,text,textarea"),s&&a===n?o=l.filter('[data-menu="'+s+'"]'):s=(o=c(l).eq(0)).attr("data-menu"),m&&m.setItem("tmadminextratab-context",n),0<o.length&&!o.is(".active")&&x(s,o,i,e.table))}),c(e).on("click",".tc-save-button",function(t){var e,s,o,a=c(this).closest("form");e=c("#tm_epo_math"),s=c(".constantrow"),o={},s.toArray().forEach(function(t,e){var t=c(t),s=t.find(".constant-name"),a=s.val(),t=t.find(".constant-value"),n=t.val(),s=s.closest(".constant-label-wrap"),t=t.closest(".constant-label-wrap");""===a?s.addClass("tm-error"):s.removeClass("tm-error"),""===n?t.addClass("tm-error"):t.removeClass("tm-error"),""===a&&""===n||(o["m"+e]={name:String(a),value:String(n)})}),e.val(JSON.stringify(o)),s=a.tcSerializeObject(),s=c.extend(!0,s,{action:"tm_save_settings",save:"save",security:r.settings_nonce}),t.preventDefault(),y(a,s)}),c(e).on("click",".tc-reset-button",function(t){var e,s,a,n,o=c(this).closest("form"),i=c.extend(!0,{},{action:"tm_reset_settings",save:"save",security:r.settings_nonce});t.preventDefault(),t=r.i18n_reset_settings,e=y,s=this,a=[o,i,!0],t=c.epoAPI.template.html(l.wp.template("tc-floatbox"),{id:"tc-floatbox-content",title:t,html:"",uniqid:"",update:r.i18n_yes,cancel:r.i18n_no}),n=!1,c.tcFloatBox({closefadeouttime:0,overlayopacity:.6,animateOut:"",fps:1,ismodal:!0,refresh:"fixed",width:"50%",height:"auto",classname:"flasho tc-wrapper tc-question",data:t,cancelEvent:function(t){n||(n=!0,t.destroy())},cancelClass:".floatbox-cancel",updateEvent:function(t){n||(n=!0,e.apply(s,a),t.destroy())},updateClass:".floatbox-update",isconfirm:!0})}),c(".tm-settings-wrap .tm-tabs").tcTabs({scroll:!1}),c(".tm-activate-license").on("click",function(t){t.preventDefault(),i("activate")}),c(".tm-deactivate-license").on("click",function(t){t.preventDefault(),i("deactivate")}),c("#tm_epo_display").on("change",function(){p(c(this))}),c("#tm_epo_options_placement").on("change",function(){_(c(this))}),c("#tm_epo_totals_box_placement").on("change",function(){d(c(this))}),c("#tm_epo_css_styles").on("change",function(){g(c(this))}),c("#tm_epo_css_styles_style").on("change",function(){b(c(this))}),c("#tm_epo_css_selected_border").on("change",function(){w(c(this))}),c("#tm_epo_floating_totals_box").on("change",function(){u(c(this))}),c("#tm_epo_floating_totals_box_visibility").on("change",function(){f(c(this))}),c("#tm_epo_show_price_inside_option").on("change",function(){h(c(this))}),c("#tm_epo_show_hide_uploaded_file_url_cart").on("change",function(){v(c(this))}),p(c("#tm_epo_display")),_(c("#tm_epo_options_placement")),d(c("#tm_epo_totals_box_placement")),t=c("#tm_epo_css_styles_style"),c(t).closest("td").css("position","relative").append('<label class="tm-epo-field-label"><span class="tc-epo-style-wrapper"><input type="checkbox" checked><span class="tm-epo-style"></span></span></label><label class="tm-epo-field-label"><span class="tc-epo-style-wrapper"><input type="radio" checked><span class="tm-epo-style"></span></span></label>'),b(c("#tm_epo_css_styles_style")),g(c("#tm_epo_css_styles")),t=c("#tm_epo_css_selected_border"),c(t).closest("td").css("position","relative").append('<div class="tm-border-type"></div>'),w(c("#tm_epo_css_selected_border")),u(c("#tm_epo_floating_totals_box")),f(c("#tm_epo_floating_totals_box_visibility")),h(c("#tm_epo_show_price_inside_option")),v(c("#tm_epo_show_hide_uploaded_file_url_cart")),t=c("#tm_epo_math"),n="",t.closest("tr").hide(),a=(a=c.epoAPI.util.parseJSON(t.val()))||{},Object.keys(a).forEach(function(t,e){var s=a[t].name,t=a[t].value;n+=c.epoAPI.template.html(l.wp.template("tc-constant-template"),{id:e,labelname:r.i18n_constant_name,labelvalue:r.i18n_constant_value,constantname:s,constantvalue:t,labelnameclass:""===s?" tm-error":"",labelvalueclass:""===t?" tm-error":""})}),c(".tc-add-constant").closest("tr").before(n),c(e).on("click",".tc-add-constant",function(){var t=c(this).closest("tr"),e=c(".constantrow").length;t.before(c.epoAPI.template.html(l.wp.template("tc-constant-template"),{id:e,labelname:r.i18n_constant_name,labelvalue:r.i18n_constant_value}))}),c(e).on("click",".tc-constant-delete .delete",function(){c(this).closest("tr").remove()}),c(e).on("change blur keyup",".constant-name, .constant-value",function(){var t=c(this),e=t.closest(".constant-label-wrap");""===t.val()?e.addClass("tm-error"):e.removeClass("tm-error")}),c(e).on("click.cpf",".tm-mn-movetodir,.tm-mn-deldir,.tm-mn-delfile",function(t){var e=c(this),s=c(".forminp-tm_html");t.preventDefault(),0<s.length&&(s.data("doing_ajax")||e.is(".tm-mn-deldir")&&!o(r.i18n_mn_delete_folder)||e.is(".tm-mn-delfile")&&!o(r.i18n_mn_delete_file)||(e.prepend('<i class="tm-icon tcfa tcfa-spin tcfa-spinner"></i>'),s.data("doing_ajax",1).block({message:null}),t={action:"tm_mn_movetodir",dir:e.attr("data-tm-dir"),security:r.settings_nonce},e.is(".tm-mn-deldir")?(t.action="tm_mn_deldir",t.tmdir=e.attr("data-tm-deldir")):e.is(".tm-mn-delfile")&&(t.action="tm_mn_delfile",t.tmfile=e.attr("data-tm-delfile"),t.tmdir=e.attr("data-tm-deldir")),c.post(r.ajax_url,t,function(t){t&&t.result&&""!==t.result?s.html(t.result):t&&t.error&&t.message&&(t=c.epoAPI.template.html(l.wp.template("tc-floatbox-import"),{id:"tc-floatbox-content",title:r.i18n_error_title,html:'<div class="tm-inner">'+t.message+"</div>",cancel:r.i18n_cancel}),c.tcFloatBox({closefadeouttime:0,animateOut:"",fps:1,ismodal:!0,refresh:"fixed",width:"50%",height:"300px",classname:"flasho tc-wrapper tm-error",data:t}))},"json").always(function(){s.data("doing_ajax",0).unblock(),e.find(".tm-icon").remove()})))})),c.tcToolTip()})}(window,document,window.jQuery);